<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RemNote-Style Daily Notes with Selection & Copy/Paste</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        /* Layout */
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            gap: 30px;
        }
        
        .sidebar {
            flex: 0 0 320px;
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            height: fit-content;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Floating buttons container - CENTERED VERTICALLY */
        .floating-buttons {
            position: fixed;
            top: 50%;
            right: 10px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 1000;
        }
        
        .floating-btn {
            width: 40px;
            height: 40px;
            border-radius: 40%;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .floating-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }
        
        .floating-btn.selfchat {
            background: linear-gradient(135deg, #667eea 0%, #764ba3 100%);
        }

        .floating-btn.capacities {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .floating-btn.amplenote {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .floating-btn.remnote {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .floating-btn.dynalist {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }
        
        .floating-btn.workflowy {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        
        .floating-btn.notion-mail {
            background: linear-gradient(135deg, #FF6B6B 0%, #EE5A52 100%);
        }

        .floating-btn.notion-calendar {
            background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
        }
        
        .floating-btn.notion-so {
            background: linear-gradient(135deg, #00A8FF 0%, #0097E6 100%);
        }

        .floating-btn.github-lab {
            background: linear-gradient(135deg, #6CC644 0%, #5AB031 100%);
        }

        .floating-btn.timestripe {
            background: linear-gradient(135deg, #FF7E5F 0%, #FEB47B 100%);
        }

        .floating-btn.facebook-messages {
            background: linear-gradient(135deg, #0084FF 0%, #0066CC 100%);
        }

        .floating-btn.instagram {
            background: linear-gradient(135deg, #0084FF 0%, #0066CC 100%);
        }
        
        .floating-btn .tooltip {
            position: absolute;
            right: 70px;
            background-color: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
        }
        
        .floating-btn .tooltip:after {
            content: '';
            position: absolute;
            top: 50%;
            right: -6px;
            margin-top: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: transparent transparent transparent #2c3e50;
        }
        
        .floating-btn:hover .tooltip {
            opacity: 1;
        }
        
        /* Top Navigation Bar */
        .top-nav-bar {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px 20px;
            margin: 0 auto 20px;
            max-width: 1400px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .date-nav-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .nav-btn {
            background-color: #f0f7ff;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: #3498db;
            font-size: 16px;
        }
        
        .nav-btn:hover {
            background-color: #e1f0ff;
        }
        
        .today-btn {
            background-color: #2ecc71;
            color: white;
            width: auto;
            padding: 0 15px;
            border-radius: 18px;
            font-size: 14px;
        }
        
        .today-btn:hover {
            background-color: #27ae60;
        }
        
        .delete-day-btn {
            background-color: #e74c3c;
            color: white;
            width: auto;
            padding: 0 15px;
            border-radius: 18px;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .delete-day-btn:hover {
            background-color: #c0392b;
        }
        
        .current-date-display {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            min-width: 200px;
            text-align: center;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            width: 300px;
        }
        
        .search-input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s;
        }
        
        .search-input:focus {
            border-color: #3498db;
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #7f8c8d;
        }
        
        /* Date Picker Button */
        .date-picker-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .date-picker-btn:hover {
            background-color: #2980b9;
        }
        
        /* 7-Day Navigation Bar */
        .week-navigation {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .week-days {
            display: flex;
            flex: 1;
            justify-content: space-between;
            margin: 0 20px;
        }
        
        .week-day {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            min-width: 70px;
            transition: all 0.2s;
            position: relative;
        }
        
        .week-day:hover {
            background-color: #f5f7fa;
        }
        
        .week-day.active {
            background-color: #e1f0ff;
            border: 1px solid #3498db;
        }
        
        .week-day-name {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
            text-transform: uppercase;
        }
        
        .week-day-date {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .week-day.active .week-day-date {
            color: #3498db;
        }
        
        .week-day.today .week-day-date {
            color: #2ecc71;
        }
        
        /* Highlight for dates with data */
        .week-day.has-data:after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #3498db;
        }
        
        .week-day.has-data.today:after {
            background-color: #2ecc71;
        }
        
        .week-day.has-data.active:after {
            background-color: white;
        }
        
        /* Small Month Calendar in Sidebar */
        .mini-calendar {
            margin-top: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .mini-calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .mini-calendar-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .mini-calendar-nav {
            display: flex;
            gap: 5px;
        }
        
        .mini-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        
        .mini-calendar-day-header {
            text-align: center;
            font-size: 11px;
            color: #7f8c8d;
            padding: 5px 0;
            font-weight: 600;
        }
        
        .mini-calendar-day {
            text-align: center;
            padding: 8px 0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s;
            position: relative;
        }
        
        .mini-calendar-day:hover {
            background-color: #eef5ff;
        }
        
        .mini-calendar-day.today {
            background-color: #2ecc71;
            color: white;
        }
        
        .mini-calendar-day.selected {
            background-color: #3498db;
            color: white;
        }
        
        .mini-calendar-day.other-month {
            color: #ccc;
        }
        
        /* Highlight for dates with data in mini calendar */
        .mini-calendar-day.has-data {
            font-weight: 600;
        }
        
        .mini-calendar-day.has-data:after {
            content: '';
            position: absolute;
            bottom: 3px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #3498db;
        }
        
        .mini-calendar-day.has-data.today:after {
            background-color: white;
        }
        
        .mini-calendar-day.has-data.selected:after {
            background-color: white;
        }
        
        .mini-calendar-day.other-month.has-data:after {
            background-color: #a0d2ff;
        }
        
        /* Sections */
        .section {
            background-color: #fff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        
        .section-header {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-header i {
            color: #3498db;
        }
        
        /* Bullet Lists - with drag handles */
        .bullet-list {
            list-style-type: none;
            padding-left: 0;
            min-height: 50px;
        }
        
        .bullet-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 4px;
            padding: 2px 2px 2px 0;
            position: relative;
            cursor: move;
            border-radius: 3px;
        }
        
        .bullet-item:hover {
            background-color: #f8f9fa;
        }
        
        .bullet-item.dragging {
            opacity: 0.5;
            background-color: #f0f7ff;
            border: 1px dashed #3498db;
        }
        
        .bullet-item.drag-over {
            border-top: 2px solid #3498db;
        }
        
        .bullet-item.highlight {
            background-color: #fff9e6;
            border-left: 3px solid #f39c12;
        }
        
        /* Selection styles for bullet items */
        .bullet-item.selected,
        .goal-item.selected {
            background-color: #e8f4fc !important;
            border-left: 3px solid #3498db !important;
            box-shadow: 0 0 0 1px #3498db;
        }

        .bullet-item.multi-selected,
        .goal-item.multi-selected {
            background-color: #e1f0ff !important;
            border-left: 3px solid #2980b9 !important;
        }
        
        /* Drag handle on the left */
        .drag-handle {
            width: 20px;
            color: #95a5a6;
            cursor: move;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s;
            margin-right: 5px;
        }
        
        .bullet-item:hover .drag-handle {
            opacity: 1;
        }
        
        /* Actions menu on the left */
        .bullet-actions {
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            display: flex;
            gap: 5px;
        }
        
        .bullet-item:hover .bullet-actions {
            opacity: 1;
        }
        
        .bullet-action-btn {
            background: none;
            border: none;
            color: #95a5a6;
            cursor: pointer;
            font-size: 14px;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .bullet-action-btn:hover {
            background-color: #f0f0f0;
            color: #333;
        }
        
        /* Update bullet-icon for notes */
        .bullet-icon {
            margin-right: 10px;
            color: #95a5a6;
            cursor: pointer;
            font-size: 18px;
            user-select: none;
            min-width: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Add checkbox styling for todos */
        .bullet-item.todo .bullet-icon {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: #2ecc71;
            cursor: pointer;
            position: relative;
            top: 1px;
        }
        
        /* Adjust spacing for todo items with checkboxes */
        .bullet-item.todo {
            align-items: center;
        }
        
        .bullet-item.todo .bullet-content {
            margin-top: 1px;
        }
        
        /* Change to this for tighter spacing: */
        .bullet-content {
            flex: 1;
            min-height: 18px;
            outline: none;
            padding: 0px 2px;
            border: 1px solid transparent;
            border-radius: 2px;
            position: relative;
            font-size: 15px;
            line-height: 1.4;
        }
        
        .bullet-content:focus {
            background-color: #fff;
            border: 1px solid #3498db;
        }
        
        .bullet-content[placeholder]:empty:before {
            content: attr(placeholder);
            color: #aaa;
        }
        
        .bullet-item.done .bullet-content {
            text-decoration: line-through;
            color: #95a5a6;
        }
        
        .bullet-item.done .bullet-icon {
            color: #2ecc71;
        }
        
        .bullet-item.todo .bullet-icon {
            color: #e74c3c;
        }
        
        .bullet-item.note .bullet-icon {
            color: #3498db;
        }
        
        /* Indentation levels */
        .indent-level-1 { margin-left: 20px; }
        .indent-level-2 { margin-left: 40px; }
        .indent-level-3 { margin-left: 60px; }
        .indent-level-4 { margin-left: 80px; }
        
        /* Goals */
        .goals-container {
            margin-top: 25px;
        }
        
        .goals-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .goals-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .goals-list {
            margin-bottom: 10px;
        }
        
        .goal-item {
            display: flex;
            align-items: center;
            padding: 6px 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
            margin-bottom: 4px;
            cursor: move;
            position: relative;
        }
        
        .goal-item:hover {
            background-color: #eef5ff;
        }
        
        .goal-item.dragging {
            opacity: 0.5;
            background-color: #f0f7ff;
            border: 1px dashed #3498db;
        }
        
        .goal-item.drag-over {
            border-top: 2px solid #3498db;
        }
        
        .goal-checkbox {
            margin-right: 8px;
            width: 16px;
            height: 16px;
            accent-color: #2ecc71;
            cursor: pointer;
        }
        
        .goal-text {
            flex: 1;
            min-height: 20px;
            outline: none;
            padding: 1px 3px;
            border: 1px solid transparent;
            border-radius: 2px;
            font-size: 15px;
        }
        
        .goal-text:focus {
            background-color: #fff;
            border: 1px solid #3498db;
        }
        
        .goal-text[placeholder]:empty:before {
            content: attr(placeholder);
            color: #aaa;
        }
        
        .goal-item.done .goal-text {
            text-decoration: line-through;
            color: #95a5a6;
        }
        
        /* Goal drag handle */
        .goal-drag-handle {
            margin-right: 6px;
            color: #95a5a6;
            cursor: move;
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 12px;
        }
        
        .goal-item:hover .goal-drag-handle {
            opacity: 1;
        }
        
        /* Selection controls */
        .selection-controls {
            position: fixed;
            bottom: 20px;
            right: 100px;
            background: white;
            border-radius: 8px;
            padding: 10px 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            gap: 10px;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .selection-count {
            font-weight: 600;
            color: #3498db;
            margin-right: 10px;
        }
        
        /* Multi-select instructions */
        .select-mode-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #2ecc71;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: none;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* Search Results */
        .search-results {
            background-color: #fff;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            max-height: 400px;
            overflow-y: auto;
        }
        
        .search-results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .search-results-count {
            font-size: 14px;
            color: #7f8c8d;
        }
        
        .search-result-item {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .search-result-item:hover {
            background-color: #f8f9fa;
        }
        
        .search-result-date {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }
        
        .search-result-content {
            font-size: 14px;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .search-result-type {
            display: inline-block;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background-color: #e8f4fc;
            color: #3498db;
        }
        
        /* Buttons */
        .btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
        }
        
        .btn-secondary {
            background-color: #f0f7ff;
            color: #3498db;
        }
        
        .btn-secondary:hover {
            background-color: #e1f0ff;
        }
        
        .btn-success {
            background-color: #2ecc71;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #27ae60;
        }
        
        .add-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #3498db;
            background-color: transparent;
            border: none;
            padding: 8px 0;
            margin-top: 10px;
            cursor: pointer;
            font-size: 14px;
            border-radius: 5px;
            width: 100%;
            justify-content: center;
        }
        
        .add-btn:hover {
            background-color: #f0f7ff;
        }
        
        /* Stats & Controls */
        .stats {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .stat-label {
            color: #7f8c8d;
        }
        
        .stat-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .file-controls {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        /* Slash Command Menu */
        .slash-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            min-width: 200px;
            display: none;
        }
        
        .slash-menu-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 14px;
        }
        
        .slash-menu-item:last-child {
            border-bottom: none;
        }
        
        .slash-menu-item:hover {
            background-color: #f5f7fa;
        }
        
        .slash-menu-item i {
            color: #7f8c8d;
            width: 20px;
        }
        
        .slash-menu-item.delete {
            color: #e74c3c;
        }
        
        .slash-menu-item.delete i {
            color: #e74c3c;
        }
        
        /* Date Picker Modal */
        .date-picker-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .date-picker-content {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            width: 350px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .date-picker-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .date-picker-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .date-picker-close {
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .date-picker-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }
        
        .date-picker-day {
            text-align: center;
            font-weight: 600;
            color: #7f8c8d;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .date-picker-date {
            text-align: center;
            padding: 10px 0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }
        
        .date-picker-date:hover {
            background-color: #f0f7ff;
        }
        
        .date-picker-date.selected {
            background-color: #3498db;
            color: white;
        }
        
        .date-picker-date.other-month {
            color: #ccc;
        }
        
        .date-picker-date.today {
            border: 2px solid #3498db;
        }
        
        /* Highlight for dates with data in date picker */
        .date-picker-date.has-data {
            font-weight: 600;
        }
        
        .date-picker-date.has-data:after {
            content: '';
            position: absolute;
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: #3498db;
        }
        
        .date-picker-date.has-data.today:after {
            background-color: #2ecc71;
        }
        
        .date-picker-date.has-data.selected:after {
            background-color: white;
        }
        
        .date-picker-date.other-month.has-data:after {
            background-color: #a0d2ff;
        }
        
        .date-picker-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .date-picker-btn-modal {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            border: none;
        }
        
        .date-picker-btn-modal.cancel {
            background-color: #f5f7fa;
            color: #7f8c8d;
        }
        
        .date-picker-btn-modal.select {
            background-color: #3498db;
            color: white;
        }
        
        /* Delete Confirmation Modal */
        .delete-confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .delete-confirm-content {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            width: 400px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }
        
        .delete-confirm-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #e74c3c;
        }
        
        .delete-confirm-text {
            margin-bottom: 20px;
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .delete-confirm-stats {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .delete-confirm-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .delete-confirm-stat:last-child {
            margin-bottom: 0;
        }
        
        .delete-confirm-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            margin-top: 20px;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
            }
            
            .floating-buttons {
                right: 15px;
            }
            
            .selection-controls {
                right: 20px;
                bottom: 80px;
            }
        }
        
        @media (max-width: 768px) {
            .top-nav-bar {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .date-nav-controls {
                justify-content: center;
            }
            
            .search-container {
                width: 100%;
            }
            
            .week-days {
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .week-day {
                min-width: 60px;
            }
            
            .floating-buttons {
                right: 10px;
            }
            
            .floating-btn {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .selection-controls {
                flex-wrap: wrap;
                right: 10px;
                bottom: 70px;
                padding: 8px 12px;
            }
            
            .selection-count {
                width: 100%;
                text-align: center;
                margin-bottom: 5px;
            }
        }

/* Dropdown menu for section headers */
.dropdown {
    position: relative;
    display: inline-block;
}

.dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.2s;
    background-color: #f0f7ff;
    color: #3498db;
}

.dropdown-toggle:hover {
    background-color: #e1f0ff;
}

.dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    z-index: 1000;
    display: none;
    min-width: 180px;
    padding: 8px 0;
    margin: 2px 0 0;
    font-size: 14px;
    text-align: left;
    list-style: none;
    background-color: white;
    background-clip: padding-box;
    border: 1px solid #ddd;
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.dropdown-menu.show {
    display: block;
    animation: fadeIn 0.2s ease;
}

.dropdown-item {
    display: block;
    width: 100%;
    padding: 10px 16px;
    clear: both;
    font-weight: normal;
    color: #2c3e50;
    text-align: inherit;
    white-space: nowrap;
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.2s;
}

.dropdown-item:hover {
    background-color: #f5f7fa;
    color: #3498db;
}

/* Arrow indicator */
.dropdown-toggle::after {
    content: 'â–¼';
    font-size: 10px;
    margin-left: 4px;
    transition: transform 0.2s;
}

.dropdown.show .dropdown-toggle::after {
    transform: rotate(180deg);
}
        
        @media (max-width: 480px) {
            .floating-buttons {
                right: 8px;
                gap: 10px;
            }
            
            .floating-btn {
                width: 40px;
                height: 40px;
                font-size: 13px;
            }
            
            .floating-btn .tooltip {
                font-size: 12px;
                padding: 6px 10px;
            }
            
            .selection-controls {
                bottom: 60px;
                right: 5px;
                padding: 5px 8px;
            }
            
            .select-mode-indicator {
                left: 10px;
                bottom: 10px;
                font-size: 12px;
                padding: 6px 10px;
            }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Recent Notes styling - COMPACT VERSION */
        .recent-notes {
            margin-bottom: 20px;
        }

        .recent-note {
            padding: 10px 12px;
            margin-bottom: 8px;
            background-color: #f8f9fa;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .recent-note:hover {
            background-color: #eef5ff;
            transform: translateX(2px);
        }

        .recent-note.active {
            background-color: #e1f0ff;
            border-left: 3px solid #3498db;
        }

        .recent-note-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 5px;
        }

        .recent-note-icon {
            display: flex;
            align-items: center;
            position: relative;
        }

        .recent-note-count {
            position: absolute;
            top: -6px;
            right: -6px;
            background-color: #3498db;
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .recent-note-short-date {
            font-size: 11px;
            color: #7f8c8d;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .recent-note-preview {
            font-size: 13px;
            color: #5d6d7e;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            max-height: 2.6em;
        }

        /* Make the sidebar title smaller too */
        .sidebar h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* 7-Day Review Section */
        .review-section {
            background-color: #fff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            display: none;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .review-title {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .review-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .review-filter {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: #fff;
            font-size: 14px;
            cursor: pointer;
            outline: none;
        }

        .review-filter:focus {
            border-color: #3498db;
        }

        .day-panel {
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .day-panel:hover {
            border-color: #3498db;
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.1);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: #f8f9fa;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s;
        }

        .day-header:hover {
            background-color: #eef5ff;
        }

        .day-header.active {
            background-color: #e1f0ff;
            border-bottom: 1px solid #3498db;
        }

        .day-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: #2c3e50;
        }

        .day-date {
            font-size: 16px;
        }

        .day-stats {
            display: flex;
            gap: 15px;
            font-size: 14px;
            color: #7f8c8d;
        }

        .day-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .day-stat i {
            width: 16px;
        }

        .day-stat.notes {
            color: #3498db;
        }

        .day-stat.todos {
            color: #2ecc71;
        }

        .day-stat.goals {
            color: #e74c3c;
        }

        .day-content {
            padding: 20px;
            display: none;
            background-color: #fff;
        }

        .day-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .day-content-section {
            margin-bottom: 20px;
        }

        .day-content-section:last-child {
            margin-bottom: 0;
        }

        .day-section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .day-item {
            padding: 8px 10px;
            margin-bottom: 5px;
            border-left: 3px solid #eee;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .day-item:hover {
            background-color: #f8f9fa;
            border-left-color: #3498db;
        }

        .day-item.note {
            border-left-color: #3498db;
        }

        .day-item.todo {
            border-left-color: #2ecc71;
        }

        .day-item.todo.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .day-item.goal {
            border-left-color: #e74c3c;
        }

        .day-item.goal.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .item-content {
            display: flex;
            align-items: flex-start;
            gap: 8px;
        }

        .item-icon {
            width: 20px;
            text-align: center;
            flex-shrink: 0;
            color: #95a5a6;
            font-size: 14px;
        }

        .item-text {
            flex: 1;
            line-height: 1.4;
        }

        .indent-level-1 { margin-left: 20px; }
        .indent-level-2 { margin-left: 40px; }
        .indent-level-3 { margin-left: 60px; }
        .indent-level-4 { margin-left: 80px; }

        .no-items {
            padding: 15px;
            text-align: center;
            color: #95a5a6;
            font-style: italic;
        }

        .view-toggle-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
        }

        .view-toggle-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            background-color: #f0f7ff;
            color: #3498db;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-toggle-btn:hover {
            background-color: #e1f0ff;
        }

        .view-toggle-btn.active {
            background-color: #3498db;
            color: white;
        }

        /* Calendar Hover Preview */
        .calendar-preview {
            position: fixed;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 320px;
            max-width: 90vw;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            animation: fadeIn 0.2s ease;
            border: 1px solid #e0e0e0;
        }

        .calendar-preview-header {
            padding: 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
        }

        .calendar-preview-date {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .calendar-preview-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #7f8c8d;
        }

        .calendar-preview-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .calendar-preview-content {
            padding: 15px;
        }

        .calendar-preview-section {
            margin-bottom: 15px;
        }

        .calendar-preview-section:last-child {
            margin-bottom: 0;
        }

        .calendar-preview-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .calendar-preview-item {
            padding: 6px 8px;
            margin-bottom: 4px;
            border-left: 3px solid #eee;
            border-radius: 3px;
            font-size: 13px;
            line-height: 1.4;
        }

        .calendar-preview-item.note {
            border-left-color: #3498db;
        }

        .calendar-preview-item.todo {
            border-left-color: #2ecc71;
        }

        .calendar-preview-item.todo.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .calendar-preview-item.goal {
            border-left-color: #e74c3c;
        }

        .calendar-preview-item.goal.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .calendar-preview-empty {
            padding: 10px;
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            font-size: 13px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Week Day Hover Preview */
        .week-preview {
            position: fixed;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 320px;
            max-width: 90vw;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            animation: fadeIn 0.2s ease;
            border: 1px solid #e0e0e0;
        }

        .week-preview-header {
            padding: 15px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
        }

        .week-preview-date {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .week-preview-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #7f8c8d;
        }

        .week-preview-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .week-preview-content {
            padding: 15px;
        }

        .week-preview-section {
            margin-bottom: 15px;
        }

        .week-preview-section:last-child {
            margin-bottom: 0;
        }

        .week-preview-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .week-preview-item {
            padding: 6px 8px;
            margin-bottom: 4px;
            border-left: 3px solid #eee;
            border-radius: 3px;
            font-size: 13px;
            line-height: 1.4;
        }

        .week-preview-item.note {
            border-left-color: #3498db;
        }

        .week-preview-item.todo {
            border-left-color: #2ecc71;
        }

        .week-preview-item.todo.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .week-preview-item.goal {
            border-left-color: #e74c3c;
        }

        .week-preview-item.goal.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .week-preview-empty {
            padding: 10px;
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            font-size: 13px;
        }

        /* Empty state for review */
        .review-empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #95a5a6;
        }

        .review-empty-state i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }

        .review-empty-state h3 {
            margin-bottom: 10px;
            color: #7f8c8d;
        }

        /* Recent Note Tooltip - Enhanced for Complete Notes */
        .recent-note {
            position: relative;
        }

        .recent-note-tooltip {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            bottom: calc(100% + 10px);
            background-color: white;
            color: #2c3e50;
            padding: 0;
            border-radius: 8px;
            font-size: 13px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            width: 320px;
            max-width: 90vw;
            white-space: normal;
            line-height: 1.4;
            text-align: left;
            border: 1px solid #e0e0e0;
            max-height: 500px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .recent-note-tooltip:after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px;
            border-style: solid;
            border-color: white transparent transparent transparent;
        }

        .recent-note:hover .recent-note-tooltip {
            opacity: 1;
        }

        .recent-note-tooltip-header {
            background-color: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            border-radius: 8px 8px 0 0;
        }

        .recent-note-tooltip-date {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 16px;
        }

        .recent-note-tooltip-stats {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #7f8c8d;
        }

        .recent-note-tooltip-stat {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .recent-note-tooltip-stat.notes {
            color: #3498db;
        }

        .recent-note-tooltip-stat.todos {
            color: #2ecc71;
        }

        .recent-note-tooltip-stat.goals {
            color: #e74c3c;
        }

        .recent-note-tooltip-content {
            padding: 15px;
            overflow-y: auto;
            max-height: 430px;
            flex: 1;
        }

        .recent-note-tooltip-section {
            margin-bottom: 15px;
        }

        .recent-note-tooltip-section:last-child {
            margin-bottom: 0;
        }

        .recent-note-tooltip-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .recent-note-tooltip-item {
            padding: 6px 8px;
            margin-bottom: 4px;
            border-left: 3px solid #eee;
            border-radius: 3px;
            font-size: 13px;
            line-height: 1.4;
        }

        .recent-note-tooltip-item.note {
            border-left-color: #3498db;
        }

        .recent-note-tooltip-item.todo {
            border-left-color: #2ecc71;
        }

        .recent-note-tooltip-item.todo.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .recent-note-tooltip-item.goal {
            border-left-color: #e74c3c;
        }

        .recent-note-tooltip-item.goal.done {
            opacity: 0.7;
            text-decoration: line-through;
            color: #95a5a6;
        }

        .recent-note-tooltip-empty {
            padding: 10px;
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            font-size: 13px;
        }

        /* Indentation for nested items */
        .recent-note-tooltip-item.indent-1 { margin-left: 20px; }
        .recent-note-tooltip-item.indent-2 { margin-left: 40px; }
        .recent-note-tooltip-item.indent-3 { margin-left: 60px; }
        .recent-note-tooltip-item.indent-4 { margin-left: 80px; }

        /* Drag and drop visual feedback */
        .section.drag-over {
            background-color: #f0f7ff;
            border: 2px dashed #3498db;
        }
        
        .section.drag-over .section-header {
            color: #3498db;
        }
        
        .section.drag-over .section-header i {
            color: #3498db;
        }

        /* NEW: Section Header Items */
        .bullet-item.section-header {
            border-top: 1px solid #e0e0e0;
            border-bottom: 1px solid #e0e0e0;
            background-color: #f8f9fa;
            margin-top: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #3498db;
            font-weight: 600;
            color: #2c3e50;
        }

        .bullet-item.section-header .bullet-content {
            font-weight: 600;
            color: #2c3e50;
        }

        .bullet-item.section-header .bullet-icon {
            color: #3498db;
            font-size: 14px;
        }

        .bullet-item.section-header .bullet-content[placeholder]:empty:before {
            content: "Type section header...";
            color: #95a5a6;
            font-weight: normal;
        }

        /* NEW: Section control button styling */
        .section-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        /* NEW: Section header drag handle */
        .bullet-item.section-header .drag-handle {
            color: #3498db;
        }

        /* NEW: Section header actions */
        .bullet-item.section-header .bullet-action-btn {
            color: #3498db;
        }

        /* NEW: Section header when selected */
        .bullet-item.section-header.selected,
        .bullet-item.section-header.multi-selected {
            background-color: #e8f4fc !important;
            border-left-color: #2980b9 !important;
        }

        /* Notification styling */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideIn 0.3s ease;
        }
    </style>
</head>
<body>
    <!-- Floating Buttons - CENTERED VERTICALLY -->
    <div class="floating-buttons">
        <button class="floating-btn selfchat" id="open-selfchat">
            <i class="fa-regular fa-comment-dots"></i>
            <span class="tooltip">Open Self-Chat</span>
        </button>
        <button class="floating-btn capacities" id="open-capacities">
            <i class="fas fa-brain"></i>
            <span class="tooltip">Open Capacities.io</span>
        </button>
        <button class="floating-btn amplenote" id="open-amplenote">
            <i class="fas fa-sticky-note"></i>
            <span class="tooltip">Open Amplenote</span>
        </button>
        <button class="floating-btn remnote" id="open-remnote">
            <i class="fas fa-book"></i>
            <span class="tooltip">Open RemNote</span>
        </button>
        <button class="floating-btn dynalist" id="open-dynalist">
            <i class="fas fa-list-alt"></i>
            <span class="tooltip">Open Dynalist</span>
        </button>
        <button class="floating-btn workflowy" id="open-workflowy">
            <i class="fas fa-stream"></i>
            <span class="tooltip">Open Workflowy</span>
        </button>
        <button class="floating-btn notion-mail" id="open-notion-mail">
            <i class="fas fa-envelope"></i>
            <span class="tooltip">Open Notion Mail</span>
        </button>
        <button class="floating-btn notion-calendar" id="open-notion-calendar">
            <i class="fas fa-calendar-alt"></i>
            <span class="tooltip">Open Notion Calendar</span>
        </button>
        <button class="floating-btn notion-so" id="open-notion-so">
            <i class="fas fa-sticky-note"></i>
            <span class="tooltip">Open Notion.so</span>
        </button>
        <button class="floating-btn github-lab" id="open-github-lab">
            <i class="fas fa-calendar-week"></i>
            <span class="tooltip">View Week Calendar</span>
        </button>
        <button class="floating-btn timestripe" id="open-timestripe">
            <i class="fas fa-hourglass-half"></i>
            <span class="tooltip">Open Timestripe Horizons</span>
        </button>
        <button class="floating-btn facebook-messages" id="open-facebook-messages">
            <i class="fab fa-facebook-messenger"></i>
            <span class="tooltip">Open Facebook Messages</span>
        </button>
        <button class="floating-btn instagram" id="open-instagram">
            <i class="fa-brands fa-square-instagram"></i>
            <span class="tooltip">Open Instagram</span>
        </button>
    </div>
    
    <!-- Selection Controls -->
    <div class="selection-controls" id="selection-controls">
        <span class="selection-count" id="selected-count">0 selected</span>
        <button class="btn btn-primary" id="copy-selected-btn">
            <i class="fas fa-copy"></i> Copy
        </button>
        <button class="btn btn-primary" id="paste-btn">
            <i class="fas fa-paste"></i> Paste
        </button>
        <button class="btn btn-secondary" id="cut-selected-btn">
            <i class="fas fa-cut"></i> Cut
        </button>
        <button class="btn" id="deselect-all-btn">
            <i class="fas fa-times"></i> Clear
        </button>
    </div>
    
    <!-- Selection Mode Indicator -->
    <div class="select-mode-indicator" id="select-mode-indicator">
        <i class="fas fa-mouse-pointer"></i> Selection Mode Active (Ctrl+Click to multi-select)
    </div>
    
    <!-- Calendar Hover Preview -->
    <div class="calendar-preview" id="calendar-preview"></div>
    
    <!-- Week Day Hover Preview -->
    <div class="week-preview" id="week-preview"></div>
    
    <!-- Top Navigation Bar -->
    <div class="top-nav-bar">
        <div class="date-nav-controls">
            <button class="nav-btn" id="prev-day">
                <i class="fas fa-chevron-left"></i>
            </button>
            <div class="current-date-display" id="nav-date-display">December 10, 2023</div>
            <button class="nav-btn" id="next-day">
                <i class="fas fa-chevron-right"></i>
            </button>
            <button class="nav-btn today-btn" id="today-btn">
                <i class="fas fa-calendar-day"></i> Today
            </button>
            <button class="nav-btn delete-day-btn" id="delete-day-btn">
                <i class="fas fa-trash-alt"></i> Delete Day
            </button>
        </div>
        
        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Search notes and todos...">
            <i class="fas fa-search search-icon"></i>
        </div>
        
        <button class="date-picker-btn" id="open-date-picker">
            <i class="far fa-calendar-alt"></i> Calendar
        </button>
    </div>
    
    <!-- View Toggle Buttons -->
    <div class="view-toggle-buttons" id="view-toggle-buttons">
        <button class="view-toggle-btn active" id="daily-view-btn">
            <i class="fas fa-calendar-day"></i> Daily View
        </button>
        <button class="view-toggle-btn" id="review-view-btn">
            <i class="fas fa-calendar-week"></i> 7-Day Review
        </button>
    </div>
    
    <!-- 7-Day Review Section -->
    <div class="review-section" id="review-section">
        <div class="review-header">
            <div class="review-title">
                <i class="fas fa-history"></i> Last 7 Days Review
            </div>
            <div class="review-controls">
                <select class="review-filter" id="review-filter">
                    <option value="all">Show All</option>
                    <option value="notes">Notes Only</option>
                    <option value="todos">Todos Only</option>
                    <option value="incomplete">Incomplete Tasks Only</option>
                    <option value="goals">Goals Only</option>
                </select>
                <button class="btn btn-secondary" id="expand-all-btn">
                    <i class="fas fa-expand-alt"></i> Expand All
                </button>
                <button class="btn btn-secondary" id="collapse-all-btn">
                    <i class="fas fa-compress-alt"></i> Collapse All
                </button>
            </div>
        </div>

        <div id="review-content">
            <!-- 7-day review content will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- 7-Day Navigation Bar -->
    <div class="week-navigation">
        <div class="nav-controls">
            <button class="nav-btn" id="prev-week">
                <i class="fas fa-chevron-left"></i>
            </button>
        </div>
        
        <div class="week-days" id="week-days">
            <!-- Week days will be populated by JavaScript -->
        </div>
        
        <div class="nav-controls">
            <button class="nav-btn" id="next-week">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
    
    <!-- Search Results -->
    <div class="search-results hidden" id="search-results">
        <div class="search-results-header">
            <div class="section-header">
                <i class="fas fa-search"></i> Search Results
            </div>
            <div class="search-results-count" id="results-count">0 results</div>
        </div>
        <div id="search-results-list">
            <!-- Search results will be populated by JavaScript -->
        </div>
    </div>
    
    <!-- Slash Command Menu -->
    <div class="slash-menu" id="slash-menu">
        <div class="slash-menu-item delete" data-action="delete">
            <i class="fas fa-trash-alt"></i>
            <span>Delete Item</span>
        </div>
        <div class="slash-menu-item" data-action="move-today">
            <i class="fas fa-calendar-day"></i>
            <span>Move to Today</span>
        </div>
        <div class="slash-menu-item" data-action="move-tomorrow">
            <i class="fas fa-calendar-plus"></i>
            <span>Move to Tomorrow</span>
        </div>
        <div class="slash-menu-item" data-action="move-date">
            <i class="far fa-calendar-alt"></i>
            <span>Move to Specific Date</span>
        </div>
        <div class="slash-menu-item" data-action="duplicate">
            <i class="fas fa-copy"></i>
            <span>Duplicate Item</span>
        </div>
        <div class="slash-menu-item" data-action="convert-to-note">
            <i class="fas fa-sticky-note"></i>
            <span>Convert to Note</span>
        </div>
        <div class="slash-menu-item" data-action="convert-to-task">
            <i class="fas fa-tasks"></i>
            <span>Convert to Task</span>
        </div>
        <div class="slash-menu-item" data-action="convert-to-section">
            <i class="fas fa-grip-lines"></i>
            <span>Convert to Section Header</span>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="delete-confirm-modal" id="delete-confirm-modal">
        <div class="delete-confirm-content">
            <div class="delete-confirm-header">
                <i class="fas fa-exclamation-triangle fa-lg"></i>
                <h3>Delete Day Confirmation</h3>
            </div>
            <div class="delete-confirm-text">
                Are you sure you want to delete all data for <strong id="delete-date-text">December 10, 2023</strong>? This action cannot be undone.
            </div>
            <div class="delete-confirm-stats">
                <div class="delete-confirm-stat">
                    <span>Notes to delete:</span>
                    <span id="delete-notes-count">0</span>
                </div>
                <div class="delete-confirm-stat">
                    <span>Todos to delete:</span>
                    <span id="delete-todos-count">0</span>
                </div>
                <div class="delete-confirm-stat">
                    <span>Goals to delete:</span>
                    <span id="delete-goals-count">0</span>
                </div>
            </div>
            <div class="delete-confirm-actions">
                <button class="date-picker-btn-modal cancel" id="delete-cancel-btn">Cancel</button>
                <button class="date-picker-btn-modal" id="delete-confirm-btn" style="background-color: #e74c3c; color: white;">Delete Day</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Daily Goals -->
            <div class="goals-container">
                <div class="goals-header">
                    <div class="goals-title">
                        <i class="fas fa-bullseye"></i> Daily Goals
                    </div>
                    <div class="nav-controls">
                        <button class="nav-btn" id="add-goal-btn" title="Add Goal">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button class="nav-btn" id="clear-done-goals" title="Clear Completed">
                            <i class="fas fa-check-double"></i>
                        </button>
                    </div>
                </div>
                <div class="goals-list" id="goals-list">
                    <!-- Goals will be populated by JavaScript -->
                </div>
                <button class="add-btn" id="add-goal-full-btn">
                    <i class="fas fa-plus"></i> Add Goal
                </button>
            </div>

            <!-- Mini Calendar -->
            <div class="mini-calendar">
                <div class="mini-calendar-header">
                    <div class="mini-calendar-title" id="mini-calendar-title">December 2023</div>
                    <div class="mini-calendar-nav">
                        <button class="nav-btn" id="prev-mini-month">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="nav-btn" id="next-mini-month">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                <div class="mini-calendar-grid" id="mini-calendar-grid">
                    <!-- Mini calendar will be populated by JavaScript -->
                </div>
            </div>

            <h3><i class="fas fa-calendar-alt"></i> Recent Notes</h3>
            <div class="recent-notes" id="recent-notes-list">
                <!-- Recent notes will be populated by JavaScript -->
            </div>
            
            <!-- File Controls -->
            <div class="file-controls">
                <button class="btn btn-success" id="save-data-btn">
                    <i class="fas fa-save"></i> Save to JSON
                </button>
                <button class="btn btn-primary" id="load-data-btn">
                    <i class="fas fa-folder-open"></i> Load from JSON
                </button>
                <button class="btn btn-secondary" id="toggle-select-mode">
                    <i class="fas fa-mouse-pointer"></i> Select Mode
                </button>
                <input type="file" id="file-input" class="hidden" accept=".json">
            </div>
            
            <!-- Stats -->
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-label">Tasks Completed:</span>
                    <span class="stat-value" id="completed-tasks">0/0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Notes Created:</span>
                    <span class="stat-value" id="notes-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Goals Progress:</span>
                    <span class="stat-value" id="goals-progress">0/0</span>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Daily Notes Section -->
            <div class="section" id="notes-section" data-type="note">
                <div class="section-header">
                    <i class="fas fa-sticky-note"></i> Daily Notes
                </div>
                
                <!-- NEW: Section Controls for Notes -->
<!-- Update the Notes section controls with the dropdown menu -->
<div class="section-controls">
    <button class="btn btn-secondary" id="add-section-btn-notes">
        <i class="fas fa-grip-lines"></i> Add Section
    </button>
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle" id="notes-section-dropdown" type="button">
            <i class="fas fa-list"></i> Add Named Section
        </button>
        <div class="dropdown-menu" id="notes-section-menu">
            <a class="dropdown-item" href="#" data-section="Personal">Personal</a>
            <a class="dropdown-item" href="#" data-section="Lab">Lab</a>
            <a class="dropdown-item" href="#" data-section="Social">Social</a>
            <a class="dropdown-item" href="#" data-section="IMB-NCHU">IMB-NCHU</a>
        </div>
    </div>
    <button class="btn btn-secondary" id="remove-empty-sections-btn-notes">
        <i class="fas fa-trash-alt"></i> Remove Empty
    </button>
</div>
                
                <ul class="bullet-list" id="notes-list">
                    <!-- Notes will be loaded based on selected date -->
                </ul>
                <button class="add-btn" id="add-note-btn">
                    <i class="fas fa-plus"></i> Add Note
                </button>
            </div>
            
            <!-- To-Do List Section -->
            <div class="section" id="todo-section" data-type="todo">
                <div class="section-header">
                    <i class="fas fa-tasks"></i> To-Do List
                </div>
                
                <!-- Section Controls -->
                <div class="section-controls">
                    <button class="btn btn-secondary" id="add-section-btn">
                        <i class="fas fa-grip-lines"></i> Add Section
                    </button>
<!-- In the To-Do List Section, add this button to the section controls -->
<button class="btn btn-secondary" id="add-dated-section-btn">
    <i class="fas fa-calendar-day"></i> Add Today-todo
</button>
                    <button class="btn btn-secondary" id="remove-empty-sections-btn">
                        <i class="fas fa-trash-alt"></i> Remove Empty Sections
                    </button>
                </div>
                
                <ul class="bullet-list" id="todo-list">
                    <!-- Todos will be loaded based on selected date -->
                </ul>
                <button class="add-btn" id="add-todo-btn">
                    <i class="fas fa-plus"></i> Add Task
                </button>
            </div>
        </div>
    </div>
    
    <!-- Date Picker Modal -->
    <div class="date-picker-modal" id="date-picker-modal">
        <div class="date-picker-content">
            <div class="date-picker-header">
                <div class="date-picker-title">Select Date</div>
                <button class="date-picker-close" id="date-picker-close">&times;</button>
            </div>
            <div class="date-picker-grid" id="date-picker-days">
                <!-- Day headers -->
                <div class="date-picker-day">Sun</div>
                <div class="date-picker-day">Mon</div>
                <div class="date-picker-day">Tue</div>
                <div class="date-picker-day">Wed</div>
                <div class="date-picker-day">Thu</div>
                <div class="date-picker-day">Fri</div>
                <div class="date-picker-day">Sat</div>
                <!-- Dates will be populated by JavaScript -->
            </div>
            <div class="date-picker-actions">
                <button class="date-picker-btn-modal cancel" id="date-picker-cancel">Cancel</button>
                <button class="date-picker-btn-modal select" id="date-picker-select">Select</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>&copy; 2026 Dr. Wen-Ming Yang. All rights reserved v2.0. RemNote-Style Daily Notes (Task note switch)</p>
    </div>

    <script>
        // Data storage
        let notesData = {};
        let todosData = {};
        let goalsData = {};
        let recentNotesData = [];

        // Global variables
        let currentDate = new Date();
        let selectedDate = new Date(currentDate);
        let miniCalendarMonth = new Date().getMonth();
        let miniCalendarYear = new Date().getFullYear();
        let selectedItemForMove = null;
        let datePickerMode = 'navigation';
        let dragItem = null;
        let dragType = null;
        let dragSourceList = null;
        
        // Selection variables
        let selectedItems = new Set();
        let isSelectMode = false;
        let copyBuffer = [];
        
        // View toggle variables
        let currentView = 'daily'; // 'daily' or 'review'
        
        // Calendar hover preview variables
        let calendarPreviewTimeout = null;
        let calendarPreviewVisible = false;

        // Initialize the app
        function initApp() {
            loadSampleData();
            updateDateDisplays();
            updateWeekNavigation();
            updateMiniCalendar();
            loadDailyView();
            loadRecentNotes();
            updateStats();
            setupEventListeners();
            loadFromLocalStorage();
            setupAutoRemoveBlankItems();
        }

        // Setup floating button event listeners for NEW BROWSER WINDOWS
        function setupFloatingButtons() {
            // Self-chat button - opens in new browser window
            document.getElementById('open-selfchat').addEventListener('click', () => {
                openExternalWindow(
                    'https://yangwm2005.github.io/lab/self-chat%20v209T10.html', 
                    'Self-Chat',
                    'width=800,height=700,left=50,top=70'
                );
            });

            // Capacities button - opens in new browser window
            document.getElementById('open-capacities').addEventListener('click', () => {
                openExternalWindow(
                    'https://app.capacities.io/1f5ca3f1-3cd4-4557-9688-9a540b210313', 
                    'Capacities',
                    'width=1000,height=700,left=50,top=100'
                );
            });
            
            // Amplenote button - opens in new browser window
            document.getElementById('open-amplenote').addEventListener('click', () => {
                openExternalWindow(
                    'https://www.amplenote.com/notes/jots?tag=daily-jots', 
                    'Amplenote',
                    'width=1000,height=700,left=100,top=100'
                );
            });
            
            // Remnote button - opens in new browser window
            document.getElementById('open-remnote').addEventListener('click', () => {
                openExternalWindow(
                    'https://www.remnote.com/', 
                    'RemNote',
                    'width=1000,height=700,left=150,top=100'
                );
            });
            
            // Dynalist button - opens in new browser window
            document.getElementById('open-dynalist').addEventListener('click', () => {
                openExternalWindow(
                    'https://dynalist.io/d/cnyrFPbIzRCFEUEtfbxvQh1h', 
                    'Dynalist',
                    'width=1000,height=700,left=200,top=100'
                );
            });
            
            // Workflowy button - opens in new browser window
            document.getElementById('open-workflowy').addEventListener('click', () => {
                openExternalWindow(
                    'https://workflowy.com/', 
                    'Workflowy',
                    'width=1000,height=700,left=250,top=100'
                );
            });
            
            // Notion Mail button
            document.getElementById('open-notion-mail').addEventListener('click', () => {
                openExternalWindow(
                    'https://mail.notion.so/inbox', 
                    'Notion Mail',
                    'width=1000,height=700,left=300,top=100'
                );
            });
            
            // Notion Calendar button
            document.getElementById('open-notion-calendar').addEventListener('click', () => {
                openExternalWindow(
                    'https://calendar.notion.so/', 
                    'Notion Calendar',
                    'width=1000,height=700,left=350,top=100'
                );
            });
            
            // Notion.so button
            document.getElementById('open-notion-so').addEventListener('click', () => {
                openExternalWindow(
                    'https://www.notion.so/', 
                    'Notion',
                    'width=1000,height=700,left=400,top=100'
                );
            });
            
            // GitHub Lab Calendar button
            document.getElementById('open-github-lab').addEventListener('click', () => {
                openExternalWindow(
                    'https://yangwm2005.github.io/lab/weekcalendar2-q.html', 
                    'GitHub Lab Calendar',
                    'width=1000,height=700,left=450,top=100'
                );
            });
            
            // Timestripe Horizons button
            document.getElementById('open-timestripe').addEventListener('click', () => {
                openExternalWindow(
                    'https://timestripe.com/horizons/', 
                    'Timestripe Horizons',
                    'width=1000,height=700,left=50,top=100'
                );
            });
            
            // Facebook Messages button
            document.getElementById('open-facebook-messages').addEventListener('click', () => {
                openExternalWindow(
                    'https://www.facebook.com/messages/t/2456192477736153', 
                    'Facebook Messages',
                    'width=1000,height=700,left=100,top=100'
                );
            });

            // Instagram button
            document.getElementById('open-instagram').addEventListener('click', () => {
                openExternalWindow(
                    'https://www.instagram.com/direct/inbox/', 
                    'Instagram',
                    'width=1000,height=700,left=100,top=100'
                );
            });
        }

        // Open external URL in new browser window (not tab)
        function openExternalWindow(url, title, windowFeatures) {
            const defaultFeatures = 'width=1000,height=700,scrollbars=yes,resizable=yes,status=yes,toolbar=yes,location=yes,menubar=yes';
            const features = windowFeatures || defaultFeatures;
            
            try {
                const newWindow = window.open(url, title, features);
                
                if (newWindow) {
                    newWindow.focus();
                    
                    try {
                        if (newWindow.opener === null) {
                            newWindow.opener = self;
                        }
                    } catch (e) {
                        // Some browsers block access to window.opener
                    }
                } else {
                    openExternalWindowAlternative(url, title);
                }
            } catch (error) {
                console.error('Error opening window:', error);
                openExternalWindowAlternative(url, title);
            }
        }

        // Alternative method for opening windows if primary method fails
        function openExternalWindowAlternative(url, title) {
            try {
                const form = document.createElement('form');
                form.method = 'GET';
                form.action = url;
                form.target = '_blank';
                
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'forceWindow';
                input.value = 'true';
                form.appendChild(input);
                
                document.body.appendChild(form);
                form.submit();
                document.body.removeChild(form);
                
                setTimeout(() => {
                    if (window.focus) {
                        const openedWindows = window.open('', '_blank');
                        if (openedWindows && openedWindows.focus) {
                            openedWindows.focus();
                        }
                    }
                }, 100);
                
            } catch (error) {
                console.error('Alternative method failed:', error);
                
                const message = `Could not open ${title}. Please:\n\n1. Allow popups for this site\n2. Or hold Ctrl/Cmd while clicking the button\n3. Or right-click and select "Open in new window"`;
                
                if (window.showModalDialog) {
                    window.showModalDialog('<html><body style="padding:20px;font-family:Arial;">' + 
                        '<h3>Browser Popup Blocked</h3>' + 
                        '<p>' + message.replace(/\n/g, '<br>') + '</p>' + 
                        '</body></html>', 'Popup Blocked');
                } else {
                    alert(message);
                }
            }
        }

        // Check if date has any data (notes, todos, or goals)
        function dateHasData(dateString) {
            return (
                (notesData[dateString] && notesData[dateString].length > 0) ||
                (todosData[dateString] && todosData[dateString].length > 0) ||
                (goalsData[dateString] && goalsData[dateString].length > 0)
            );
        }

        // Load sample data
        function loadSampleData() {
            // Sample notes data with indentation and section headers
            notesData = {
                '2023-12-10': [
                    { id: 1, content: 'Meeting Notes', type: 'note', isSection: true, indent: 0 },
                    { id: 2, content: 'Meeting with team about Q4 planning', type: 'note', indent: 1 },
                    { id: 3, content: 'Need to prepare presentation slides', type: 'note', indent: 2 },
                    { id: 4, content: 'Research Notes', type: 'note', isSection: true, indent: 0 },
                    { id: 5, content: 'Research new productivity tools', type: 'note', indent: 1 },
                    { id: 6, content: 'Follow up with design team', type: 'note', indent: 1 },
                    { id: 7, content: 'Check budget approval status', type: 'note', indent: 2 }
                ],
                '2023-12-09': [
                    { id: 1, content: 'Completed project documentation', type: 'note', indent: 0 },
                    { id: 2, content: 'Client feedback received', type: 'note', indent: 1 }
                ],
                '2023-12-08': [
                    { id: 1, content: 'Started new React project', type: 'note', indent: 0 },
                    { id: 2, content: 'Set up development environment', type: 'note', indent: 1 }
                ],
                '2023-12-07': [
                    { id: 1, content: 'Weekly team sync meeting notes', type: 'note', indent: 0 }
                ],
                '2023-12-06': [
                    { id: 1, content: 'Project deadline approaching', type: 'note', indent: 0 }
                ]
            };

            // Sample todos data with indentation and section headers
            todosData = {
                '2023-12-10': [
                    { id: 1, content: 'Morning Tasks', type: 'todo', isSection: true, done: false, indent: 0 },
                    { id: 2, content: 'Check emails', type: 'todo', done: true, indent: 1 },
                    { id: 3, content: 'Plan day schedule', type: 'todo', done: false, indent: 1 },
                    { id: 4, content: 'Project Work', type: 'todo', isSection: true, done: false, indent: 0 },
                    { id: 5, content: 'Finish project proposal', type: 'todo', done: false, indent: 1 },
                    { id: 6, content: 'Include budget section', type: 'todo', done: true, indent: 2 },
                    { id: 7, content: 'Add timeline visualization', type: 'todo', done: false, indent: 2 },
                    { id: 8, content: 'Email client updates', type: 'todo', done: true, indent: 0 },
                    { id: 9, content: 'Review code changes', type: 'todo', done: false, indent: 0 }
                ],
                '2023-12-09': [
                    { id: 1, content: 'Update project timeline', type: 'todo', done: true, indent: 0 },
                    { id: 2, content: 'Prepare meeting agenda', type: 'todo', done: true, indent: 0 }
                ],
                '2023-12-08': [
                    { id: 1, content: 'Set up CI/CD pipeline', type: 'todo', done: true, indent: 0 }
                ]
            };

            // Sample goals data
            goalsData = {
                '2023-12-10': [
                    { id: 1, text: 'Complete project proposal', done: false },
                    { id: 2, text: 'Exercise for 30 minutes', done: true },
                    { id: 3, text: 'Read 20 pages', done: false }
                ],
                '2023-12-09': [
                    { id: 1, text: 'Morning meditation', done: true },
                    { id: 2, text: 'Plan week ahead', done: true }
                ],
                '2023-12-08': [
                    { id: 1, text: 'Complete morning routine', done: true }
                ]
            };

            // Sample recent notes
            recentNotesData = [
                { date: '2023-12-10', title: 'Team Meeting Notes', preview: 'Meeting with team about Q4 planning...' },
                { date: '2023-12-09', title: 'Project Documentation', preview: 'Completed project documentation...' },
                { date: '2023-12-08', title: 'New Project Setup', preview: 'Started new React project...' },
                { date: '2023-12-07', title: 'Weekly Sync', preview: 'Weekly team sync meeting notes...' },
                { date: '2023-12-06', title: 'Project Deadline', preview: 'Project deadline approaching...' }
            ];
        }

        // Format date as YYYY-MM-DD
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Format date for display
        function formatDateDisplay(date) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Format date for short display (e.g., "Mon, Dec 10")
        function formatDateShort(date) {
            const options = { weekday: 'short', month: 'short', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }

        // Update all date displays
        function updateDateDisplays() {
            document.getElementById('nav-date-display').textContent = formatDateDisplay(selectedDate);
        }

        // Update week navigation with hover support
        function updateWeekNavigation() {
            const weekDays = document.getElementById('week-days');
            weekDays.innerHTML = '';
            
            const dates = [];
            for (let i = -3; i <= 3; i++) {
                const date = new Date(selectedDate);
                date.setDate(date.getDate() + i);
                dates.push(date);
            }
            
            dates.forEach(date => {
                const dateString = formatDate(date);
                const isToday = dateString === formatDate(new Date());
                const isActive = dateString === formatDate(selectedDate);
                const hasData = dateHasData(dateString);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'week-day';
                if (isActive) dayElement.classList.add('active');
                if (isToday) dayElement.classList.add('today');
                if (hasData) dayElement.classList.add('has-data');
                dayElement.dataset.date = dateString;
                
                dayElement.innerHTML = `
                    <div class="week-day-name">${date.toLocaleDateString('en-US', { weekday: 'short' })}</div>
                    <div class="week-day-date">${date.getDate()}</div>
                `;
                
                if (hasData) {
                    dayElement.title = 'Has notes/todos/goals';
                }
                
                dayElement.addEventListener('mouseenter', (e) => {
                    if (dateHasData(dateString)) {
                        calendarPreviewTimeout = setTimeout(() => {
                            showWeekPreview(date, dateString, e.clientX, e.clientY);
                        }, 500);
                    }
                });
                
                dayElement.addEventListener('mouseleave', () => {
                    if (calendarPreviewTimeout) {
                        clearTimeout(calendarPreviewTimeout);
                        calendarPreviewTimeout = null;
                    }
                    setTimeout(() => {
                        if (!isMouseOverWeekPreview()) {
                            hideWeekPreview();
                        }
                    }, 300);
                });
                
                dayElement.addEventListener('click', () => {
                    selectedDate = new Date(dateString);
                    updateDateDisplays();
                    updateWeekNavigation();
                    updateMiniCalendar();
                    loadDailyView();
                    updateRecentNotesActiveState();
                });
                
                weekDays.appendChild(dayElement);
            });
        }

        // Update mini calendar with hover support
        function updateMiniCalendar() {
            const calendarGrid = document.getElementById('mini-calendar-grid');
            calendarGrid.innerHTML = '';
            
            const days = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
            days.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'mini-calendar-day-header';
                dayHeader.textContent = day;
                calendarGrid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(miniCalendarYear, miniCalendarMonth, 1);
            const lastDay = new Date(miniCalendarYear, miniCalendarMonth + 1, 0);
            const daysInMonth = lastDay.getDate();
            const firstDayOfWeek = firstDay.getDay();
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                const prevDate = new Date(miniCalendarYear, miniCalendarMonth, -i);
                const dayElement = createMiniCalendarDay(prevDate, true);
                calendarGrid.appendChild(dayElement);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(miniCalendarYear, miniCalendarMonth, day);
                const dayElement = createMiniCalendarDay(date, false);
                calendarGrid.appendChild(dayElement);
            }
            
            const monthName = new Date(miniCalendarYear, miniCalendarMonth).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            document.getElementById('mini-calendar-title').textContent = monthName;
        }

        // Create mini calendar day element with hover support
        function createMiniCalendarDay(date, isOtherMonth) {
            const dateString = formatDate(date);
            const isToday = dateString === formatDate(new Date());
            const isSelected = dateString === formatDate(selectedDate);
            const hasData = dateHasData(dateString);
            
            const dayElement = document.createElement('div');
            dayElement.className = 'mini-calendar-day';
            if (isOtherMonth) dayElement.classList.add('other-month');
            if (isToday) dayElement.classList.add('today');
            if (isSelected) dayElement.classList.add('selected');
            if (hasData) dayElement.classList.add('has-data');
            dayElement.dataset.date = dateString;
            dayElement.textContent = date.getDate();
            
            dayElement.addEventListener('mouseenter', (e) => {
                if (dateHasData(dateString)) {
                    calendarPreviewTimeout = setTimeout(() => {
                        showCalendarPreview(date, dateString, e.clientX, e.clientY);
                    }, 500);
                }
            });
            
            dayElement.addEventListener('mouseleave', () => {
                if (calendarPreviewTimeout) {
                    clearTimeout(calendarPreviewTimeout);
                    calendarPreviewTimeout = null;
                }
                setTimeout(() => {
                    if (!isMouseOverPreview()) {
                        hideCalendarPreview();
                    }
                }, 300);
            });
            
            dayElement.addEventListener('click', () => {
                selectedDate = new Date(dateString);
                updateDateDisplays();
                updateWeekNavigation();
                updateMiniCalendar();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            return dayElement;
        }

        // Show calendar preview on hover
        function showCalendarPreview(date, dateString, mouseX, mouseY) {
            const preview = document.getElementById('calendar-preview');
            
            const notes = notesData[dateString] || [];
            const todos = todosData[dateString] || [];
            const goals = goalsData[dateString] || [];
            
            const noteCount = notes.length;
            const todoCount = todos.length;
            const goalCount = goals.length;
            const totalCount = noteCount + todoCount + goalCount;
            
            let previewHTML = `
                <div class="calendar-preview-header">
                    <div class="calendar-preview-date">${formatDateDisplay(date)}</div>
                    <div class="calendar-preview-stats">
                        ${noteCount > 0 ? `<div class="calendar-preview-stat"><i class="fas fa-sticky-note" style="color: #3498db;"></i> ${noteCount}</div>` : ''}
                        ${todoCount > 0 ? `<div class="calendar-preview-stat"><i class="fas fa-tasks" style="color: #2ecc71;"></i> ${todoCount}</div>` : ''}
                        ${goalCount > 0 ? `<div class="calendar-preview-stat"><i class="fas fa-bullseye" style="color: #e74c3c;"></i> ${goalCount}</div>` : ''}
                    </div>
                </div>
                <div class="calendar-preview-content">
            `;
            
            if (noteCount > 0) {
                previewHTML += `
                    <div class="calendar-preview-section">
                        <div class="calendar-preview-section-title">
                            <i class="fas fa-sticky-note" style="color: #3498db;"></i> Notes (${noteCount})
                        </div>
                `;
                
                notes.forEach(note => {
                    const indentStyle = note.indent ? `margin-left: ${note.indent * 20}px;` : '';
                    const sectionClass = note.isSection ? 'section-header' : '';
                    previewHTML += `
                        <div class="calendar-preview-item note ${sectionClass}" style="${indentStyle}">
                            ${note.content}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (todoCount > 0) {
                previewHTML += `
                    <div class="calendar-preview-section">
                        <div class="calendar-preview-section-title">
                            <i class="fas fa-tasks" style="color: #2ecc71;"></i> Tasks (${todoCount})
                        </div>
                `;
                
                todos.forEach(todo => {
                    const doneClass = todo.done ? 'done' : '';
                    const indentStyle = todo.indent ? `margin-left: ${todo.indent * 20}px;` : '';
                    const sectionClass = todo.isSection ? 'section-header' : '';
                    previewHTML += `
                        <div class="calendar-preview-item todo ${doneClass} ${sectionClass}" style="${indentStyle}">
                            ${todo.done && !todo.isSection ? 'âœ“ ' : ''}${todo.content}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (goalCount > 0) {
                previewHTML += `
                    <div class="calendar-preview-section">
                        <div class="calendar-preview-section-title">
                            <i class="fas fa-bullseye" style="color: #e74c3c;"></i> Goals (${goalCount})
                        </div>
                `;
                
                goals.forEach(goal => {
                    const doneClass = goal.done ? 'done' : '';
                    previewHTML += `
                        <div class="calendar-preview-item goal ${doneClass}">
                            ${goal.done ? 'âœ“ ' : ''}${goal.text}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (totalCount === 0) {
                previewHTML += '<div class="calendar-preview-empty">No notes, tasks, or goals for this day</div>';
            }
            
            previewHTML += '</div>';
            
            preview.innerHTML = previewHTML;
            
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const previewWidth = 320;
            let previewHeight = Math.min(preview.scrollHeight, 500);
            
            let left = mouseX + 15;
            let top = mouseY - 10;
            
            if (left + previewWidth > viewportWidth - 20) {
                left = mouseX - previewWidth - 15;
            }
            
            if (top + previewHeight > viewportHeight - 20) {
                top = viewportHeight - previewHeight - 20;
            }
            
            if (top < 20) {
                top = 20;
            }
            
            preview.style.left = `${left}px`;
            preview.style.top = `${top}px`;
            preview.style.display = 'block';
            calendarPreviewVisible = true;
            
            let previewHovered = false;
            
            preview.addEventListener('mouseenter', () => {
                previewHovered = true;
                clearTimeout(calendarPreviewTimeout);
            });
            
            preview.addEventListener('mouseleave', () => {
                previewHovered = false;
                setTimeout(() => {
                    if (!previewHovered) {
                        hideCalendarPreview();
                    }
                }, 300);
            });
        }

        // Hide calendar preview
        function hideCalendarPreview() {
            const preview = document.getElementById('calendar-preview');
            preview.style.display = 'none';
            calendarPreviewVisible = false;
        }

        // Check if mouse is over preview
        function isMouseOverPreview() {
            const preview = document.getElementById('calendar-preview');
            const hoveredElement = document.elementFromPoint(
                event.clientX || 0,
                event.clientY || 0
            );
            return preview.contains(hoveredElement);
        }

        // Show week preview on hover
        function showWeekPreview(date, dateString, mouseX, mouseY) {
            const preview = document.getElementById('week-preview');
            
            const notes = notesData[dateString] || [];
            const todos = todosData[dateString] || [];
            const goals = goalsData[dateString] || [];
            
            const noteCount = notes.length;
            const todoCount = todos.length;
            const goalCount = goals.length;
            const totalCount = noteCount + todoCount + goalCount;
            
            let previewHTML = `
                <div class="week-preview-header">
                    <div class="week-preview-date">${formatDateDisplay(date)}</div>
                    <div class="week-preview-stats">
                        ${noteCount > 0 ? `<div class="week-preview-stat"><i class="fas fa-sticky-note" style="color: #3498db;"></i> ${noteCount}</div>` : ''}
                        ${todoCount > 0 ? `<div class="week-preview-stat"><i class="fas fa-tasks" style="color: #2ecc71;"></i> ${todoCount}</div>` : ''}
                        ${goalCount > 0 ? `<div class="week-preview-stat"><i class="fas fa-bullseye" style="color: #e74c3c;"></i> ${goalCount}</div>` : ''}
                    </div>
                </div>
                <div class="week-preview-content">
            `;
            
            if (noteCount > 0) {
                previewHTML += `
                    <div class="week-preview-section">
                        <div class="week-preview-section-title">
                            <i class="fas fa-sticky-note" style="color: #3498db;"></i> Notes (${noteCount})
                        </div>
                `;
                
                notes.forEach(note => {
                    const indentStyle = note.indent ? `margin-left: ${note.indent * 20}px;` : '';
                    const sectionClass = note.isSection ? 'section-header' : '';
                    previewHTML += `
                        <div class="week-preview-item note ${sectionClass}" style="${indentStyle}">
                            ${note.content}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (todoCount > 0) {
                previewHTML += `
                    <div class="week-preview-section">
                        <div class="week-preview-section-title">
                            <i class="fas fa-tasks" style="color: #2ecc71;"></i> Tasks (${todoCount})
                        </div>
                `;
                
                todos.forEach(todo => {
                    const doneClass = todo.done ? 'done' : '';
                    const indentStyle = todo.indent ? `margin-left: ${todo.indent * 20}px;` : '';
                    const sectionClass = todo.isSection ? 'section-header' : '';
                    previewHTML += `
                        <div class="week-preview-item todo ${doneClass} ${sectionClass}" style="${indentStyle}">
                            ${todo.done && !todo.isSection ? 'âœ“ ' : ''}${todo.content}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (goalCount > 0) {
                previewHTML += `
                    <div class="week-preview-section">
                        <div class="week-preview-section-title">
                            <i class="fas fa-bullseye" style="color: #e74c3c;"></i> Goals (${goalCount})
                        </div>
                `;
                
                goals.forEach(goal => {
                    const doneClass = goal.done ? 'done' : '';
                    previewHTML += `
                        <div class="week-preview-item goal ${doneClass}">
                            ${goal.done ? 'âœ“ ' : ''}${goal.text}
                        </div>
                    `;
                });
                
                previewHTML += '</div>';
            }
            
            if (totalCount === 0) {
                previewHTML += '<div class="week-preview-empty">No notes, tasks, or goals for this day</div>';
            }
            
            previewHTML += '</div>';
            
            preview.innerHTML = previewHTML;
            
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const previewWidth = 320;
            let previewHeight = Math.min(preview.scrollHeight, 500);
            
            let left = mouseX - previewWidth / 2;
            let top = mouseY + 20;
            
            if (left < 20) {
                left = 20;
            }
            
            if (left + previewWidth > viewportWidth - 20) {
                left = viewportWidth - previewWidth - 20;
            }
            
            if (top + previewHeight > viewportHeight - 20) {
                top = mouseY - previewHeight - 10;
            }
            
            if (top < 20) {
                top = 20;
            }
            
            preview.style.left = `${left}px`;
            preview.style.top = `${top}px`;
            preview.style.display = 'block';
            
            let previewHovered = false;
            
            preview.addEventListener('mouseenter', () => {
                previewHovered = true;
                clearTimeout(calendarPreviewTimeout);
            });
            
            preview.addEventListener('mouseleave', () => {
                previewHovered = false;
                setTimeout(() => {
                    if (!previewHovered) {
                        hideWeekPreview();
                    }
                }, 300);
            });
        }

        // Hide week preview
        function hideWeekPreview() {
            const preview = document.getElementById('week-preview');
            preview.style.display = 'none';
        }

        // Check if mouse is over week preview
        function isMouseOverWeekPreview() {
            const preview = document.getElementById('week-preview');
            const hoveredElement = document.elementFromPoint(
                event.clientX || 0,
                event.clientY || 0
            );
            return preview && preview.contains(hoveredElement);
        }

        // Toggle between daily view and 7-day review
        function toggleView(view) {
            currentView = view;
            
            const dailySections = document.querySelectorAll('.section');
            const reviewSection = document.getElementById('review-section');
            const weekNav = document.querySelector('.week-navigation');
            const dailyViewBtn = document.getElementById('daily-view-btn');
            const reviewViewBtn = document.getElementById('review-view-btn');
            
            if (view === 'daily') {
                dailySections.forEach(section => {
                    section.style.display = 'block';
                });
                if (weekNav) weekNav.style.display = 'flex';
                reviewSection.style.display = 'none';
                dailyViewBtn.classList.add('active');
                reviewViewBtn.classList.remove('active');
            } else {
                dailySections.forEach(section => {
                    section.style.display = 'none';
                });
                if (weekNav) weekNav.style.display = 'none';
                reviewSection.style.display = 'block';
                dailyViewBtn.classList.remove('active');
                reviewViewBtn.classList.add('active');
                
                loadSevenDayReview();
            }
        }

        // Load 7-day review data
        function loadSevenDayReview() {
            const reviewContent = document.getElementById('review-content');
            const filterValue = document.getElementById('review-filter').value;
            
            reviewContent.innerHTML = '';
            
            const dates = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date);
            }
            
            let hasAnyData = false;
            
            dates.forEach(date => {
                const dateString = formatDate(date);
                const isToday = dateString === formatDate(new Date());
                
                const notes = notesData[dateString] || [];
                const todos = todosData[dateString] || [];
                const goals = goalsData[dateString] || [];
                
                let filteredNotes = [];
                let filteredTodos = [];
                let filteredGoals = [];
                
                switch(filterValue) {
                    case 'notes':
                        filteredNotes = notes;
                        break;
                    case 'todos':
                        filteredTodos = todos.filter(todo => true);
                        break;
                    case 'incomplete':
                        filteredTodos = todos.filter(todo => !todo.done);
                        break;
                    case 'goals':
                        filteredGoals = goals;
                        break;
                    default:
                        filteredNotes = notes;
                        filteredTodos = todos;
                        filteredGoals = goals;
                }
                
                const noteCount = filteredNotes.length;
                const todoCount = filteredTodos.length;
                const goalCount = filteredGoals.length;
                const totalCount = noteCount + todoCount + goalCount;
                
                if (totalCount === 0) return;
                
                hasAnyData = true;
                
                const dayPanel = document.createElement('div');
                dayPanel.className = 'day-panel';
                dayPanel.dataset.date = dateString;
                
                const dayHeader = document.createElement('div');
                dayHeader.className = 'day-header';
                if (isToday) {
                    dayHeader.classList.add('active');
                }
                
                const dayTitle = document.createElement('div');
                dayTitle.className = 'day-title';
                
                const dayDate = document.createElement('div');
                dayDate.className = 'day-date';
                dayDate.textContent = formatDateDisplay(date);
                
                if (isToday) {
                    const todayBadge = document.createElement('span');
                    todayBadge.textContent = 'Today';
                    todayBadge.style.cssText = 'font-size: 12px; background-color: #2ecc71; color: white; padding: 2px 8px; border-radius: 10px; margin-left: 8px;';
                    dayDate.appendChild(todayBadge);
                }
                
                dayTitle.appendChild(dayDate);
                
                const dayStats = document.createElement('div');
                dayStats.className = 'day-stats';
                
                if (noteCount > 0 && (filterValue === 'all' || filterValue === 'notes')) {
                    const noteStat = document.createElement('div');
                    noteStat.className = 'day-stat notes';
                    noteStat.innerHTML = `<i class="fas fa-sticky-note"></i> ${noteCount}`;
                    dayStats.appendChild(noteStat);
                }
                
                if (todoCount > 0 && (filterValue === 'all' || filterValue === 'todos' || filterValue === 'incomplete')) {
                    const todoStat = document.createElement('div');
                    todoStat.className = 'day-stat todos';
                    todoStat.innerHTML = `<i class="fas fa-tasks"></i> ${todoCount}`;
                    dayStats.appendChild(todoStat);
                }
                
                if (goalCount > 0 && (filterValue === 'all' || filterValue === 'goals')) {
                    const goalStat = document.createElement('div');
                    goalStat.className = 'day-stat goals';
                    goalStat.innerHTML = `<i class="fas fa-bullseye"></i> ${goalCount}`;
                    dayStats.appendChild(goalStat);
                }
                
                dayHeader.appendChild(dayTitle);
                dayHeader.appendChild(dayStats);
                
                const dayContent = document.createElement('div');
                dayContent.className = 'day-content';
                if (isToday) {
                    dayContent.classList.add('active');
                }
                
                if (filteredNotes.length > 0) {
                    const notesSection = document.createElement('div');
                    notesSection.className = 'day-content-section';
                    
                    const notesTitle = document.createElement('div');
                    notesTitle.className = 'day-section-title';
                    notesTitle.innerHTML = `<i class="fas fa-sticky-note" style="color: #3498db;"></i> Notes (${filteredNotes.length})`;
                    notesSection.appendChild(notesTitle);
                    
                    filteredNotes.forEach(note => {
                        const noteItem = document.createElement('div');
                        noteItem.className = `day-item note indent-level-${note.indent || 0}`;
                        if (note.isSection) {
                            noteItem.classList.add('section-header');
                        }
                        
                        const itemContent = document.createElement('div');
                        itemContent.className = 'item-content';
                        
                        const itemIcon = document.createElement('div');
                        itemIcon.className = 'item-icon';
                        if (note.isSection) {
                            itemIcon.innerHTML = '<i class="fas fa-grip-lines" style="color: #3498db;"></i>';
                        } else {
                            itemIcon.innerHTML = 'â€¢';
                        }
                        
                        const itemText = document.createElement('div');
                        itemText.className = 'item-text';
                        itemText.textContent = note.content;
                        
                        itemContent.appendChild(itemIcon);
                        itemContent.appendChild(itemText);
                        noteItem.appendChild(itemContent);
                        notesSection.appendChild(noteItem);
                    });
                    
                    dayContent.appendChild(notesSection);
                }
                
                if (filteredTodos.length > 0) {
                    const todosSection = document.createElement('div');
                    todosSection.className = 'day-content-section';
                    
                    const todosTitle = document.createElement('div');
                    todosTitle.className = 'day-section-title';
                    todosTitle.innerHTML = `<i class="fas fa-tasks" style="color: #2ecc71;"></i> Tasks (${filteredTodos.length})`;
                    todosSection.appendChild(todosTitle);
                    
                    filteredTodos.forEach(todo => {
                        const todoItem = document.createElement('div');
                        todoItem.className = `day-item todo indent-level-${todo.indent || 0}`;
                        if (todo.done) {
                            todoItem.classList.add('done');
                        }
                        if (todo.isSection) {
                            todoItem.classList.add('section-header');
                        }
                        
                        const itemContent = document.createElement('div');
                        itemContent.className = 'item-content';
                        
                        const itemIcon = document.createElement('div');
                        itemIcon.className = 'item-icon';
                        if (todo.isSection) {
                            itemIcon.innerHTML = '<i class="fas fa-grip-lines" style="color: #3498db;"></i>';
                        } else {
                            itemIcon.innerHTML = todo.done ? '<i class="fas fa-check-circle" style="color: #2ecc71;"></i>' : '<i class="far fa-circle" style="color: #95a5a6;"></i>';
                        }
                        
                        const itemText = document.createElement('div');
                        itemText.className = 'item-text';
                        itemText.textContent = todo.content;
                        
                        itemContent.appendChild(itemIcon);
                        itemContent.appendChild(itemText);
                        todoItem.appendChild(itemContent);
                        todosSection.appendChild(todoItem);
                    });
                    
                    dayContent.appendChild(todosSection);
                }
                
                if (filteredGoals.length > 0) {
                    const goalsSection = document.createElement('div');
                    goalsSection.className = 'day-content-section';
                    
                    const goalsTitle = document.createElement('div');
                    goalsTitle.className = 'day-section-title';
                    goalsTitle.innerHTML = `<i class="fas fa-bullseye" style="color: #e74c3c;"></i> Goals (${filteredGoals.length})`;
                    goalsSection.appendChild(goalsTitle);
                    
                    filteredGoals.forEach(goal => {
                        const goalItem = document.createElement('div');
                        goalItem.className = 'day-item goal';
                        if (goal.done) {
                            goalItem.classList.add('done');
                        }
                        
                        const itemContent = document.createElement('div');
                        itemContent.className = 'item-content';
                        
                        const itemIcon = document.createElement('div');
                        itemIcon.className = 'item-icon';
                        itemIcon.innerHTML = goal.done ? '<i class="fas fa-check-circle" style="color: #2ecc71;"></i>' : '<i class="far fa-circle" style="color: #95a5a6;"></i>';
                        
                        const itemText = document.createElement('div');
                        itemText.className = 'item-text';
                        itemText.textContent = goal.text;
                        
                        itemContent.appendChild(itemIcon);
                        itemContent.appendChild(itemText);
                        goalItem.appendChild(itemContent);
                        goalsSection.appendChild(goalItem);
                    });
                    
                    dayContent.appendChild(goalsSection);
                }
                
                dayHeader.addEventListener('click', () => {
                    dayContent.classList.toggle('active');
                    dayHeader.classList.toggle('active');
                });
                
                dayHeader.addEventListener('dblclick', () => {
                    toggleView('daily');
                    selectedDate = new Date(dateString);
                    updateDateDisplays();
                    updateWeekNavigation();
                    updateMiniCalendar();
                    loadDailyView();
                    updateRecentNotesActiveState();
                });
                
                dayPanel.appendChild(dayHeader);
                dayPanel.appendChild(dayContent);
                reviewContent.appendChild(dayPanel);
            });
            
            if (!hasAnyData) {
                const emptyState = document.createElement('div');
                emptyState.className = 'review-empty-state';
                emptyState.innerHTML = `
                    <i class="far fa-calendar-times"></i>
                    <h3>No Data Found</h3>
                    <p>No notes, tasks, or goals found for the last 7 days with the current filter.</p>
                    <p>Try changing the filter or add some content in daily view.</p>
                `;
                reviewContent.appendChild(emptyState);
            }
        }

        // Expand all day panels
        function expandAllPanels() {
            document.querySelectorAll('.day-content').forEach(content => {
                content.classList.add('active');
            });
            document.querySelectorAll('.day-header').forEach(header => {
                header.classList.add('active');
            });
        }

        // Collapse all day panels
        function collapseAllPanels() {
            document.querySelectorAll('.day-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll('.day-header').forEach(header => {
                header.classList.remove('active');
            });
        }

        // NEW: Add section header to notes
        function addSectionHeaderNotes() {
            const dateString = formatDate(selectedDate);
            if (!notesData[dateString]) notesData[dateString] = [];
            
            const maxId = notesData[dateString].length > 0 ? 
                Math.max(...notesData[dateString].map(n => n.id)) : 0;
            
            const newSection = {
                id: maxId + 1,
                content: 'New Section',
                type: 'note',
                isSection: true,
                indent: 0
            };
            
            notesData[dateString].push(newSection);
            loadDailyView();
            saveToLocalStorage();
            
            setTimeout(() => {
                const notesList = document.getElementById('notes-list');
                const lastNote = notesList.lastChild;
                if (lastNote) {
                    const contentElement = lastNote.querySelector('.bullet-content');
                    if (contentElement) {
                        contentElement.focus();
                        contentElement.select();
                    }
                }
            }, 10);
        }

// NEW: Function to add a named section header to notes
function addNamedSectionHeader(sectionName) {
    const dateString = formatDate(selectedDate);
    if (!notesData[dateString]) notesData[dateString] = [];
    
    const maxId = notesData[dateString].length > 0 ? 
        Math.max(...notesData[dateString].map(n => n.id)) : 0;
    
    const newSection = {
        id: maxId + 1,
        content: sectionName,
        type: 'note',
        isSection: true,
        indent: 0
    };
    
    notesData[dateString].push(newSection);
    loadDailyView();
    saveToLocalStorage();
    
    setTimeout(() => {
        const notesList = document.getElementById('notes-list');
        const lastNote = notesList.lastChild;
        if (lastNote) {
            const contentElement = lastNote.querySelector('.bullet-content');
            if (contentElement) {
                contentElement.focus();
                // Select all text for easy editing
                const range = document.createRange();
                const selection = window.getSelection();
                range.selectNodeContents(contentElement);
                selection.removeAllRanges();
                selection.addRange(range);
            }
        }
    }, 10);
}

// NEW: Setup dropdown functionality
function setupNotesSectionDropdown() {
    const dropdownToggle = document.getElementById('notes-section-dropdown');
    const dropdownMenu = document.getElementById('notes-section-menu');
    const dropdownContainer = dropdownToggle.closest('.dropdown');
    
    // Toggle dropdown
    dropdownToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        dropdownMenu.classList.toggle('show');
        dropdownContainer.classList.toggle('show');
    });
    
    // Handle menu item clicks
    dropdownMenu.querySelectorAll('.dropdown-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const sectionName = item.dataset.section;
            addNamedSectionHeader(sectionName);
            
            // Close dropdown
            dropdownMenu.classList.remove('show');
            dropdownContainer.classList.remove('show');
        });
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!dropdownContainer.contains(e.target)) {
            dropdownMenu.classList.remove('show');
            dropdownContainer.classList.remove('show');
        }
    });
    
    // Close dropdown when pressing Escape
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            dropdownMenu.classList.remove('show');
            dropdownContainer.classList.remove('show');
        }
    });
}

        // NEW: Add section header to tasks
        function addSectionHeaderTodos() {
            const dateString = formatDate(selectedDate);
            if (!todosData[dateString]) todosData[dateString] = [];
            
            const maxId = todosData[dateString].length > 0 ? 
                Math.max(...todosData[dateString].map(t => t.id)) : 0;
            
            const newSection = {
                id: maxId + 1,
                content: 'New Section',
                type: 'todo',
                isSection: true,
                done: false,
                indent: 0
            };
            
            todosData[dateString].push(newSection);
            loadDailyView();
            saveToLocalStorage();
            
            setTimeout(() => {
                const todoList = document.getElementById('todo-list');
                const lastTodo = todoList.lastChild;
                if (lastTodo) {
                    const contentElement = lastTodo.querySelector('.bullet-content');
                    if (contentElement) {
                        contentElement.focus();
                        contentElement.select();
                    }
                }
            }, 10);
        }

// NEW: Add auto-dated section header to tasks
function addDatedSectionHeaderTodos() {
    const dateString = formatDate(selectedDate);
    if (!todosData[dateString]) todosData[dateString] = [];
    
    const maxId = todosData[dateString].length > 0 ? 
        Math.max(...todosData[dateString].map(t => t.id)) : 0;
    
    // Format date as YYYYMMDD
    const year = selectedDate.getFullYear();
    const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
    const day = String(selectedDate.getDate()).padStart(2, '0');
    const dateFormat = `${year}${month}${day}`;
    
    const newSection = {
        id: maxId + 1,
        content: `Todo: ${dateFormat}`,
        type: 'todo',
        isSection: true,
        done: false,
        indent: 0
    };
    
    todosData[dateString].push(newSection);
    loadDailyView();
    saveToLocalStorage();
    
    setTimeout(() => {
        const todoList = document.getElementById('todo-list');
        const lastTodo = todoList.lastChild;
        if (lastTodo) {
            const contentElement = lastTodo.querySelector('.bullet-content');
            if (contentElement) {
                contentElement.focus();
                // Select the date part for easy editing
                const textNode = contentElement.firstChild;
                if (textNode && textNode.textContent) {
                    const range = document.createRange();
                    const selection = window.getSelection();
                    // Select from position 6 ("Todo: " is 6 characters)
                    range.setStart(textNode, 6);
                    range.setEnd(textNode, textNode.length);
                    selection.removeAllRanges();
                    selection.addRange(range);
                }
            }
        }
    }, 10);
}

        // Load daily view
        function loadDailyView() {
            const dateString = formatDate(selectedDate);
            
            clearSelection();
            
            const notesList = document.getElementById('notes-list');
            notesList.innerHTML = '';
            const notes = notesData[dateString] || [];
            notes.forEach(note => {
                const noteElement = createBulletItem(note, 'note');
                notesList.appendChild(noteElement);
            });
            
            const todoList = document.getElementById('todo-list');
            todoList.innerHTML = '';
            const todos = todosData[dateString] || [];
            todos.forEach(todo => {
                const todoElement = createBulletItem(todo, 'todo');
                todoList.appendChild(todoElement);
            });
            
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';
            const goals = goalsData[dateString] || [];
            goals.forEach(goal => {
                const goalElement = createGoalItem(goal);
                goalsList.appendChild(goalElement);
            });
            
            updateGoalStats(dateString);
            
            setupDragAndDrop('notes-list', 'note');
            setupDragAndDrop('todo-list', 'todo');
            setupDragAndDropForGoals();
        }

        // Create bullet item with slash command and drag support
        function createBulletItem(item, type) {
            const li = document.createElement('li');
            li.className = `bullet-item ${type}`;
            li.dataset.id = item.id;
            li.dataset.type = type;
            li.draggable = true;
            
            if (item.done) li.classList.add('done');
            if (item.indent > 0) li.classList.add(`indent-level-${item.indent}`);
            
            // Check if this is a section header
            if (item.isSection) {
                li.classList.add('section-header');
            }
            
            // Drag handle
            const dragHandle = document.createElement('div');
            dragHandle.className = 'drag-handle';
            dragHandle.innerHTML = '<i class="fas fa-grip-vertical"></i>';
            dragHandle.draggable = true;
            
            // Actions menu (three dots)
            const actions = document.createElement('div');
            actions.className = 'bullet-actions';
            
            const actionBtn = document.createElement('button');
            actionBtn.className = 'bullet-action-btn';
            actionBtn.innerHTML = '<i class="fas fa-ellipsis-h"></i>';
            actionBtn.title = 'Show actions (or type /)';
            actionBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                showSlashMenu(li, type);
            });
            
            actions.appendChild(actionBtn);
            
            // Bullet icon
            let icon;
            if (type === 'todo' && !item.isSection) {
                icon = document.createElement('input');
                icon.type = 'checkbox';
                icon.className = 'goal-checkbox';
                icon.checked = item.done;
                
                icon.addEventListener('change', () => {
                    item.done = icon.checked;
                    li.classList.toggle('done');
                    saveItemStatus(item, type);
                    updateStats();
                });
            } else if (item.isSection) {
                // Section header icon
                icon = document.createElement('div');
                icon.className = 'bullet-icon';
                icon.innerHTML = '<i class="fas fa-grip-lines"></i>';
            } else {
                // For notes, keep the bullet point
                icon = document.createElement('div');
                icon.className = 'bullet-icon';
                icon.textContent = 'â€¢';
            }
            
            // Content
            const content = document.createElement('div');
            content.className = 'bullet-content';
            content.textContent = item.content;
            content.contentEditable = true;
            
            // Set placeholder based on type
            if (item.isSection) {
                content.setAttribute('placeholder', 'Type section header...');
            } else if (type === 'note') {
                content.setAttribute('placeholder', 'Type your note here...');
            } else {
                content.setAttribute('placeholder', 'Add a task...');
            }
            
            // Add slash command trigger
            content.addEventListener('keydown', (e) => {
                if (e.key === '/') {
                    e.preventDefault();
                    showSlashMenu(li, type);
                }
                
                // Tab for indentation (not for section headers)
                if (e.key === 'Tab' && !item.isSection) {
                    e.preventDefault();
                    handleTabKey(item, type, li, e.shiftKey);
                }
                
                // Enter to create new item at same indentation
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    // For section headers, don't allow creating new items with Enter
                    if (!item.isSection) {
                        createNewItemAfter(item, type, li);
                    }
                }
                
                // DELETE KEY FUNCTIONALITY
                if ((e.key === 'Delete' || e.key === 'Backspace') && content.textContent.trim() === '') {
                    e.preventDefault();
                    deleteItem(item.id, type, formatDate(selectedDate));
                    return;
                }
            });
            
            content.addEventListener('input', () => {
                saveItemContent(item, type, content.textContent);
            });
            
            li.appendChild(dragHandle);
            li.appendChild(actions);
            li.appendChild(icon);
            li.appendChild(content);
            
            return li;
        }

        // Handle Tab key for indentation
        function handleTabKey(item, type, element, isShiftKey) {
            const dateString = formatDate(selectedDate);
            const data = type === 'note' ? notesData : todosData;
            
            if (!data[dateString]) return;
            
            const itemIndex = data[dateString].findIndex(i => i.id === item.id);
            if (itemIndex === -1) return;
            
            if (!isShiftKey && item.indent < 4) {
                item.indent++;
                data[dateString][itemIndex].indent = item.indent;
            } else if (isShiftKey && item.indent > 0) {
                item.indent--;
                data[dateString][itemIndex].indent = item.indent;
            }
            
            loadDailyView();
            saveToLocalStorage();
            
            setTimeout(() => {
                const updatedItem = document.querySelector(`.bullet-item[data-id="${item.id}"] .bullet-content`);
                if (updatedItem) {
                    updatedItem.focus();
                }
            }, 10);
        }

        // Create new item after current one
        function createNewItemAfter(item, type, element) {
            const dateString = formatDate(selectedDate);
            const data = type === 'note' ? notesData : todosData;
            
            if (!data[dateString]) data[dateString] = [];
            
            const itemIndex = data[dateString].findIndex(i => i.id === item.id);
            if (itemIndex === -1) return;
            
            const currentContent = element.querySelector('.bullet-content').textContent.trim();
            
            if (currentContent === '') {
                const contentElement = element.querySelector('.bullet-content');
                if (contentElement) {
                    contentElement.focus();
                }
                return;
            }
            
            const maxId = data[dateString].length > 0 ? 
                Math.max(...data[dateString].map(i => i.id)) : 0;
            
            const newItem = {
                id: maxId + 1,
                content: '',
                type: type,
                indent: item.indent,
                done: false
            };
            
            // For notes, we don't have the "done" property
            if (type === 'note') {
                delete newItem.done;
            }
            
            data[dateString].splice(itemIndex + 1, 0, newItem);
            
            loadDailyView();
            saveToLocalStorage();
            
            setTimeout(() => {
                const newItems = document.querySelectorAll(`.bullet-item[data-id="${newItem.id}"]`);
                if (newItems.length > 0) {
                    const newElement = newItems[0].querySelector('.bullet-content');
                    if (newElement) {
                        newElement.focus();
                    }
                }
            }, 10);
        }

        // Function to remove blank items when they lose focus
        function setupAutoRemoveBlankItems() {
            document.addEventListener('focusout', (e) => {
                if (e.target.classList.contains('bullet-content')) {
                    const content = e.target.textContent.trim();
                    const bulletItem = e.target.closest('.bullet-item');
                    
                    if (content === '' && bulletItem) {
                        const type = bulletItem.classList.contains('todo') ? 'todo' : 'note';
                        const itemId = parseInt(bulletItem.dataset.id);
                        
                        const list = type === 'todo' ? document.getElementById('todo-list') : document.getElementById('notes-list');
                        if (list.children.length > 1) {
                            deleteItem(itemId, type, formatDate(selectedDate));
                        }
                    }
                }
            });
        }

        // Create goal item with drag support
        function createGoalItem(goal) {
            const goalItem = document.createElement('div');
            goalItem.className = 'goal-item';
            if (goal.done) goalItem.classList.add('done');
            goalItem.dataset.id = goal.id;
            goalItem.dataset.type = 'goal';
            goalItem.draggable = true;
            
            const dragHandle = document.createElement('div');
            dragHandle.className = 'goal-drag-handle';
            dragHandle.innerHTML = '<i class="fas fa-grip-vertical"></i>';
            
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'goal-checkbox';
            checkbox.checked = goal.done;
            
            const text = document.createElement('div');
            text.className = 'goal-text';
            text.textContent = goal.text;
            text.contentEditable = true;
            text.setAttribute('placeholder', 'Enter a goal...');
            
            text.addEventListener('keydown', (e) => {
                if ((e.key === 'Delete' || e.key === 'Backspace') && text.textContent.trim() === '') {
                    e.preventDefault();
                    
                    const dateString = formatDate(selectedDate);
                    if (goalsData[dateString]) {
                        const index = goalsData[dateString].findIndex(g => g.id === goal.id);
                        if (index !== -1) {
                            goalsData[dateString].splice(index, 1);
                            loadDailyView();
                            updateStats();
                            saveToLocalStorage();
                        }
                    }
                }
            });
            
            goalItem.appendChild(dragHandle);
            goalItem.appendChild(checkbox);
            goalItem.appendChild(text);
            
            checkbox.addEventListener('change', () => {
                goal.done = checkbox.checked;
                goalItem.classList.toggle('done');
                updateGoalStats(formatDate(selectedDate));
                updateStats();
                saveToLocalStorage();
            });
            
            text.addEventListener('input', () => {
                goal.text = text.textContent;
                updateGoalStats(formatDate(selectedDate));
                saveToLocalStorage();
            });
            
            return goalItem;
        }

        // Setup drag and drop for lists
        function setupDragAndDrop(listId, type) {
            const list = document.getElementById(listId);
            
            list.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('bullet-item') || e.target.closest('.bullet-item')) {
                    const item = e.target.classList.contains('bullet-item') ? e.target : e.target.closest('.bullet-item');
                    dragItem = item;
                    dragType = type;
                    dragSourceList = listId;
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        id: item.dataset.id,
                        type: type,
                        sourceList: listId
                    }));
                    
                    document.querySelectorAll('.section').forEach(section => {
                        if (section.dataset.type !== type) {
                            section.classList.add('drag-over');
                        }
                    });
                }
            });
            
            list.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const afterElement = getDragAfterElement(list, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                document.querySelectorAll('.bullet-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                if (afterElement) {
                    afterElement.classList.add('drag-over');
                }
            });
            
            list.addEventListener('drop', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElement(list, e.clientY);
                const draggable = document.querySelector('.dragging');
                
                document.querySelectorAll('.bullet-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                document.querySelectorAll('.section.drag-over').forEach(section => {
                    section.classList.remove('drag-over');
                });
                
                if (draggable) {
                    const draggedItemType = draggable.dataset.type;
                    const targetListType = type;
                    
                    if (draggedItemType !== targetListType && dragSourceList !== listId) {
                        convertAndMoveItem(draggable, listId, afterElement);
                    } else {
                        if (afterElement) {
                            list.insertBefore(draggable, afterElement);
                        } else {
                            list.appendChild(draggable);
                        }
                        
                        updateItemOrder(listId, type);
                    }
                    
                    draggable.classList.remove('dragging');
                    dragItem = null;
                    dragType = null;
                    dragSourceList = null;
                }
            });
            
            list.addEventListener('dragend', (e) => {
                const draggable = document.querySelector('.dragging');
                if (draggable) {
                    draggable.classList.remove('dragging');
                }
                
                document.querySelectorAll('.bullet-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                document.querySelectorAll('.section.drag-over').forEach(section => {
                    section.classList.remove('drag-over');
                });
                
                dragItem = null;
                dragType = null;
                dragSourceList = null;
            });
            
            list.addEventListener('dragleave', (e) => {
                if (!e.relatedTarget || !list.contains(e.relatedTarget)) {
                    document.querySelectorAll('.bullet-item.drag-over').forEach(item => {
                        item.classList.remove('drag-over');
                    });
                }
            });
        }

        // Convert and move item between note and todo lists
        function convertAndMoveItem(itemElement, targetListId, afterElement) {
            const dateString = formatDate(selectedDate);
            const itemId = parseInt(itemElement.dataset.id);
            const sourceType = itemElement.dataset.type;
            const targetType = targetListId === 'notes-list' ? 'note' : 'todo';
            
            const sourceData = sourceType === 'note' ? notesData : todosData;
            const targetData = targetType === 'note' ? notesData : todosData;
            
            if (!sourceData[dateString]) return;
            
            const itemIndex = sourceData[dateString].findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            const originalItem = sourceData[dateString][itemIndex];
            
            const convertedItem = {
                id: originalItem.id,
                content: originalItem.content,
                type: targetType,
                indent: originalItem.indent || 0,
                done: targetType === 'todo' ? (originalItem.done || false) : false
            };
            
            // Preserve isSection property if it exists
            if (originalItem.isSection) {
                convertedItem.isSection = true;
            }
            
            sourceData[dateString].splice(itemIndex, 1);
            
            if (!targetData[dateString]) {
                targetData[dateString] = [];
            }
            
            if (afterElement) {
                const afterId = parseInt(afterElement.dataset.id);
                const afterIndex = targetData[dateString].findIndex(item => item.id === afterId);
                if (afterIndex !== -1) {
                    targetData[dateString].splice(afterIndex + 1, 0, convertedItem);
                } else {
                    targetData[dateString].push(convertedItem);
                }
            } else {
                targetData[dateString].push(convertedItem);
            }
            
            loadDailyView();
            saveToLocalStorage();
            
            showNotification(`Converted ${sourceType} to ${targetType}`);
        }

        // Setup drag and drop for goals
        function setupDragAndDropForGoals() {
            const goalsList = document.getElementById('goals-list');
            
            goalsList.addEventListener('dragstart', (e) => {
                if (e.target.classList.contains('goal-item') || e.target.closest('.goal-item')) {
                    const item = e.target.classList.contains('goal-item') ? e.target : e.target.closest('.goal-item');
                    dragItem = item;
                    dragType = 'goal';
                    dragSourceList = 'goals-list';
                    item.classList.add('dragging');
                    e.dataTransfer.effectAllowed = 'move';
                    e.dataTransfer.setData('text/plain', item.dataset.id);
                }
            });
            
            goalsList.addEventListener('dragover', (e) => {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const afterElement = getDragAfterElementGoals(goalsList, e.clientY);
                const draggable = document.querySelector('.goal-item.dragging');
                
                document.querySelectorAll('.goal-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                if (afterElement) {
                    afterElement.classList.add('drag-over');
                }
            });
            
            goalsList.addEventListener('drop', (e) => {
                e.preventDefault();
                const afterElement = getDragAfterElementGoals(goalsList, e.clientY);
                const draggable = document.querySelector('.goal-item.dragging');
                
                document.querySelectorAll('.goal-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                if (draggable) {
                    if (afterElement) {
                        goalsList.insertBefore(draggable, afterElement);
                    } else {
                        goalsList.appendChild(draggable);
                    }
                    
                    updateGoalsOrder();
                }
                
                draggable.classList.remove('dragging');
                dragItem = null;
                dragType = null;
                dragSourceList = null;
            });
            
            goalsList.addEventListener('dragend', (e) => {
                const draggable = document.querySelector('.goal-item.dragging');
                if (draggable) {
                    draggable.classList.remove('dragging');
                }
                
                document.querySelectorAll('.goal-item.drag-over').forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                dragItem = null;
                dragType = null;
                dragSourceList = null;
            });
        }

        // Helper function to get the element after which to insert
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.bullet-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Helper function to get the element after which to insert for goals
        function getDragAfterElementGoals(container, y) {
            const draggableElements = [...container.querySelectorAll('.goal-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }

        // Update item order after drag and drop
        function updateItemOrder(listId, type) {
            const dateString = formatDate(selectedDate);
            const data = type === 'note' ? notesData : todosData;
            const list = document.getElementById(listId);
            const items = [...list.querySelectorAll('.bullet-item')];
            
            const newOrder = items.map(item => parseInt(item.dataset.id));
            
            if (data[dateString]) {
                const newData = [];
                newOrder.forEach(id => {
                    const item = data[dateString].find(item => item.id === id);
                    if (item) newData.push(item);
                });
                
                data[dateString].forEach(item => {
                    if (!newOrder.includes(item.id)) {
                        newData.push(item);
                    }
                });
                
                data[dateString] = newData;
                saveToLocalStorage();
            }
        }

        // Update goals order after drag and drop
        function updateGoalsOrder() {
            const dateString = formatDate(selectedDate);
            const goalsList = document.getElementById('goals-list');
            const items = [...goalsList.querySelectorAll('.goal-item')];
            
            const newOrder = items.map(item => parseInt(item.dataset.id));
            
            if (goalsData[dateString]) {
                const newData = [];
                newOrder.forEach(id => {
                    const goal = goalsData[dateString].find(goal => goal.id === id);
                    if (goal) newData.push(goal);
                });
                
                goalsData[dateString].forEach(goal => {
                    if (!newOrder.includes(goal.id)) {
                        newData.push(goal);
                    }
                });
                
                goalsData[dateString] = newData;
                saveToLocalStorage();
            }
        }

        // Show slash command menu
        function showSlashMenu(itemElement, type) {
            const menu = document.getElementById('slash-menu');
            const rect = itemElement.getBoundingClientRect();
            
            menu.style.top = `${rect.bottom + 5}px`;
            menu.style.left = `${rect.left}px`;
            menu.style.display = 'block';
            
            menu.dataset.targetId = itemElement.dataset.id;
            menu.dataset.targetType = type;
            menu.dataset.targetDate = formatDate(selectedDate);
            
            setTimeout(() => {
                document.addEventListener('click', closeSlashMenu);
            }, 10);
        }

        // Close slash command menu
        function closeSlashMenu(e) {
            const menu = document.getElementById('slash-menu');
            if (!menu.contains(e.target)) {
                menu.style.display = 'none';
                document.removeEventListener('click', closeSlashMenu);
            }
        }

        // Handle slash menu actions
        function setupSlashMenuActions() {
            const menu = document.getElementById('slash-menu');
            
            menu.querySelectorAll('.slash-menu-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const action = item.dataset.action;
                    const targetId = menu.dataset.targetId;
                    const targetType = menu.dataset.targetType;
                    const targetDate = menu.dataset.targetDate;
                    
                    handleSlashAction(action, targetId, targetType, targetDate);
                    
                    menu.style.display = 'none';
                    document.removeEventListener('click', closeSlashMenu);
                });
            });
        }

        // Handle slash actions
        function handleSlashAction(action, itemId, itemType, itemDate) {
            itemId = parseInt(itemId);
            
            switch(action) {
                case 'delete':
                    deleteItem(itemId, itemType, itemDate);
                    break;
                case 'move-today':
                    moveItemToDate(itemId, itemType, itemDate, new Date());
                    break;
                case 'move-tomorrow':
                    const tomorrow = new Date();
                    tomorrow.setDate(tomorrow.getDate() + 1);
                    moveItemToDate(itemId, itemType, itemDate, tomorrow);
                    break;
                case 'move-date':
                    selectedItemForMove = { id: itemId, type: itemType, date: itemDate };
                    datePickerMode = 'move-item';
                    openDatePicker();
                    break;
                case 'duplicate':
                    duplicateItem(itemId, itemType, itemDate);
                    break;
                case 'convert-to-note':
                    convertItemType(itemId, itemType, itemDate, 'note');
                    break;
                case 'convert-to-task':
                    convertItemType(itemId, itemType, itemDate, 'todo');
                    break;
                case 'convert-to-section':
                    convertToSection(itemId, itemType, itemDate);
                    break;
            }
        }

        // NEW: Convert item to section header
        function convertToSection(itemId, itemType, itemDate) {
            const dateString = itemDate;
            const data = itemType === 'note' ? notesData : todosData;
            
            if (!data[dateString]) return;
            
            const itemIndex = data[dateString].findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            // Get the item
            const originalItem = data[dateString][itemIndex];
            
            // Convert to section header
            originalItem.isSection = true;
            if (itemType === 'todo') {
                originalItem.done = false; // Section headers shouldn't be marked as done
            }
            
            // Reload view
            loadDailyView();
            saveToLocalStorage();
            
            // Show notification
            showNotification('Converted to Section Header');
        }

        // Convert item type (note to task or task to note)
        function convertItemType(itemId, itemType, itemDate, targetType) {
            const dateString = itemDate;
            const data = itemType === 'note' ? notesData : todosData;
            
            if (!data[dateString]) return;
            
            const itemIndex = data[dateString].findIndex(item => item.id === itemId);
            if (itemIndex === -1) return;
            
            const originalItem = data[dateString][itemIndex];
            
            const targetData = targetType === 'note' ? notesData : todosData;
            if (!targetData[dateString]) {
                targetData[dateString] = [];
            }
            
            const convertedItem = {
                id: originalItem.id,
                content: originalItem.content,
                type: targetType,
                indent: originalItem.indent || 0,
                done: targetType === 'todo' ? (originalItem.done || false) : false
            };
            
            // Preserve isSection property if it exists
            if (originalItem.isSection) {
                convertedItem.isSection = true;
            }
            
            data[dateString].splice(itemIndex, 1);
            
            if (itemIndex < targetData[dateString].length) {
                targetData[dateString].splice(itemIndex, 0, convertedItem);
            } else {
                targetData[dateString].push(convertedItem);
            }
            
            loadDailyView();
            saveToLocalStorage();
            
            showNotification(`Converted to ${targetType === 'note' ? 'Note' : 'Task'}`);
        }

        // Delete an item
        function deleteItem(itemId, itemType, itemDate) {
            const data = itemType === 'note' ? notesData : todosData;
            let deletedIndex = -1;
            
            if (data[itemDate]) {
                const index = data[itemDate].findIndex(item => item.id === itemId);
                if (index !== -1) {
                    deletedIndex = index;
                    data[itemDate].splice(index, 1);
                    loadDailyView();
                    updateStats();
                    saveToLocalStorage();
                    
                    updateMiniCalendar();
                    updateWeekNavigation();
                    
                    setTimeout(() => {
                        const list = itemType === 'note' ? document.getElementById('notes-list') : document.getElementById('todo-list');
                        const items = list.querySelectorAll('.bullet-item');
                        
                        if (items.length > 0) {
                            let itemToFocus = null;
                            
                            if (deletedIndex < items.length) {
                                itemToFocus = items[deletedIndex];
                            } else if (items.length > 0) {
                                itemToFocus = items[items.length - 1];
                            }
                            
                            if (itemToFocus) {
                                const content = itemToFocus.querySelector('.bullet-content');
                                if (content) {
                                    content.focus();
                                    const range = document.createRange();
                                    const selection = window.getSelection();
                                    range.selectNodeContents(content);
                                    range.collapse(false);
                                    selection.removeAllRanges();
                                    selection.addRange(range);
                                }
                            }
                        }
                    }, 10);
                }
            }
        }

        // Delete entire day's data
        function deleteCurrentDay() {
            const dateString = formatDate(selectedDate);
            
            const notesCount = notesData[dateString] ? notesData[dateString].length : 0;
            const todosCount = todosData[dateString] ? todosData[dateString].length : 0;
            const goalsCount = goalsData[dateString] ? goalsData[dateString].length : 0;
            
            document.getElementById('delete-date-text').textContent = formatDateDisplay(selectedDate);
            document.getElementById('delete-notes-count').textContent = notesCount;
            document.getElementById('delete-todos-count').textContent = todosCount;
            document.getElementById('delete-goals-count').textContent = goalsCount;
            
            document.getElementById('delete-confirm-modal').style.display = 'flex';
        }

        // Confirm deletion of day
        function confirmDeleteDay() {
            const dateString = formatDate(selectedDate);
            
            delete notesData[dateString];
            delete todosData[dateString];
            delete goalsData[dateString];
            
            recentNotesData = recentNotesData.filter(note => note.date !== dateString);
            
            let nextDate = new Date(selectedDate);
            nextDate.setDate(nextDate.getDate() + 1);
            
            let foundDate = null;
            for (let i = 0; i < 30; i++) {
                const checkDate = new Date(selectedDate);
                checkDate.setDate(checkDate.getDate() + i + 1);
                const checkDateString = formatDate(checkDate);
                
                if (notesData[checkDateString] || todosData[checkDateString] || goalsData[checkDateString]) {
                    foundDate = checkDate;
                    break;
                }
            }
            
            if (!foundDate) {
                for (let i = 1; i <= 30; i++) {
                    const checkDate = new Date(selectedDate);
                    checkDate.setDate(checkDate.getDate() - i);
                    const checkDateString = formatDate(checkDate);
                    
                    if (notesData[checkDateString] || todosData[checkDateString] || goalsData[checkDateString]) {
                        foundDate = checkDate;
                        break;
                    }
                }
            }
            
            if (!foundDate) {
                foundDate = new Date();
            }
            
            selectedDate = foundDate;
            
            updateDateDisplays();
            updateWeekNavigation();
            updateMiniCalendar();
            loadDailyView();
            loadRecentNotes();
            updateStats();
            saveToLocalStorage();
            
            document.getElementById('delete-confirm-modal').style.display = 'none';
        }

        // Move item to a different date
        function moveItemToDate(itemId, itemType, fromDate, toDate) {
            const data = itemType === 'note' ? notesData : todosData;
            const toDateString = formatDate(toDate);
            
            if (!data[toDateString]) {
                data[toDateString] = [];
            }
            
            if (data[fromDate]) {
                const index = data[fromDate].findIndex(item => item.id === itemId);
                if (index !== -1) {
                    const [item] = data[fromDate].splice(index, 1);
                    
                    const maxId = data[toDateString].length > 0 ? 
                        Math.max(...data[toDateString].map(i => i.id)) : 0;
                    item.id = maxId + 1;
                    
                    data[toDateString].push(item);
                    
                    loadDailyView();
                    updateStats();
                    saveToLocalStorage();
                    
                    updateMiniCalendar();
                    updateWeekNavigation();
                }
            }
        }

        // Duplicate an item
        function duplicateItem(itemId, itemType, itemDate) {
            const data = itemType === 'note' ? notesData : todosData;
            
            if (data[itemDate]) {
                const originalItem = data[itemDate].find(item => item.id === itemId);
                if (originalItem) {
                    const copy = { ...originalItem };
                    
                    const maxId = data[itemDate].length > 0 ? 
                        Math.max(...data[itemDate].map(item => item.id)) : 0;
                    copy.id = maxId + 1;
                    
                    data[itemDate].push(copy);
                    
                    loadDailyView();
                    updateStats();
                    saveToLocalStorage();
                }
            }
        }

        // Update goal stats
        function updateGoalStats(dateString) {
            const goals = goalsData[dateString] || [];
            const completedGoals = goals.filter(g => g.done).length;
            const totalGoals = goals.length;
            
            const goalsTitle = document.querySelector('.goals-title');
            goalsTitle.innerHTML = `<i class="fas fa-bullseye"></i> Daily Goals (${completedGoals}/${totalGoals})`;
        }

        // Load recent notes
        function loadRecentNotes() {
            const recentNotesList = document.getElementById('recent-notes-list');
            recentNotesList.innerHTML = '';
            
            const allDates = new Set([
                ...Object.keys(notesData),
                ...Object.keys(todosData),
                ...Object.keys(goalsData)
            ]);
            
            const recentNotes = Array.from(allDates).map(dateString => {
                const date = new Date(dateString);
                
                let preview = '';
                let itemCount = 0;
                let iconType = '';
                
                const noteCount = notesData[dateString] ? notesData[dateString].length : 0;
                const todoCount = todosData[dateString] ? todosData[dateString].length : 0;
                const goalCount = goalsData[dateString] ? goalsData[dateString].length : 0;
                itemCount = noteCount + todoCount + goalCount;
                
                if (noteCount > 0 && todoCount > 0) {
                    iconType = 'both';
                    preview = notesData[dateString][0].content;
                } else if (noteCount > 0) {
                    iconType = 'note';
                    preview = notesData[dateString][0].content;
                } else if (todoCount > 0) {
                    iconType = 'todo';
                    preview = todosData[dateString][0].content;
                } else if (goalCount > 0) {
                    iconType = 'goal';
                    preview = goalsData[dateString][0].text;
                }
                
                if (preview.length > 60) preview = preview.substring(0, 60) + '...';
                
                return {
                    date: dateString,
                    preview: preview || 'No content',
                    itemCount: itemCount,
                    iconType: iconType,
                    noteCount: noteCount,
                    todoCount: todoCount,
                    goalCount: goalCount,
                    displayDate: formatDateDisplay(date)
                };
            });
            
            const sortedNotes = recentNotes.sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            const recentToShow = sortedNotes.slice(0, 10);
            
            recentToShow.forEach(note => {
                const noteElement = document.createElement('div');
                noteElement.className = 'recent-note';
                if (formatDate(selectedDate) === note.date) {
                    noteElement.classList.add('active');
                }
                noteElement.dataset.date = note.date;
                
                const dateData = getCompleteDateData(note.date);
                
                let iconHtml = '';
                if (dateData.noteCount > 0 && dateData.todoCount > 0) {
                    iconHtml = '<i class="fas fa-sticky-note" style="color: #3498db;"></i><i class="fas fa-tasks" style="color: #2ecc71; margin-left: 3px;"></i>';
                } else if (dateData.noteCount > 0) {
                    iconHtml = '<i class="fas fa-sticky-note" style="color: #3498db;"></i>';
                } else if (dateData.todoCount > 0) {
                    iconHtml = '<i class="fas fa-tasks" style="color: #2ecc71;"></i>';
                } else if (dateData.goalCount > 0) {
                    iconHtml = '<i class="fas fa-bullseye" style="color: #e74c3c;"></i>';
                } else {
                    iconHtml = '<i class="far fa-calendar" style="color: #95a5a6;"></i>';
                }
                
                const countBadge = dateData.totalCount > 0 ? 
                    `<span class="recent-note-count">${dateData.totalCount}</span>` : '';
                
                const shortDate = new Date(note.date).toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric' 
                });
                
                let tooltipHTML = `
                    <div class="recent-note-tooltip">
                        <div class="recent-note-tooltip-header">
                            <div class="recent-note-tooltip-date">${formatDateDisplay(new Date(note.date))}</div>
                            <div class="recent-note-tooltip-stats">
                `;
                
                if (dateData.noteCount > 0) {
                    tooltipHTML += `<div class="recent-note-tooltip-stat notes"><i class="fas fa-sticky-note"></i> ${dateData.noteCount}</div>`;
                }
                if (dateData.todoCount > 0) {
                    tooltipHTML += `<div class="recent-note-tooltip-stat todos"><i class="fas fa-tasks"></i> ${dateData.todoCount}</div>`;
                }
                if (dateData.goalCount > 0) {
                    tooltipHTML += `<div class="recent-note-tooltip-stat goals"><i class="fas fa-bullseye"></i> ${dateData.goalCount}</div>`;
                }
                
                tooltipHTML += `
                            </div>
                        </div>
                        <div class="recent-note-tooltip-content">
                `;
                
                if (dateData.noteCount > 0) {
                    tooltipHTML += `
                        <div class="recent-note-tooltip-section">
                            <div class="recent-note-tooltip-section-title">
                                <i class="fas fa-sticky-note" style="color: #3498db;"></i> Notes (${dateData.noteCount})
                            </div>
                    `;
                    
                    dateData.notes.forEach(noteItem => {
                        const indentClass = noteItem.indent ? `indent-${noteItem.indent}` : '';
                        const sectionClass = noteItem.isSection ? 'section-header' : '';
                        tooltipHTML += `
                            <div class="recent-note-tooltip-item note ${sectionClass} ${indentClass}">
                                ${noteItem.content}
                            </div>
                        `;
                    });
                    
                    tooltipHTML += '</div>';
                }
                
                if (dateData.todoCount > 0) {
                    tooltipHTML += `
                        <div class="recent-note-tooltip-section">
                            <div class="recent-note-tooltip-section-title">
                                <i class="fas fa-tasks" style="color: #2ecc71;"></i> Tasks (${dateData.todoCount})
                            </div>
                    `;
                    
                    dateData.todos.forEach(todoItem => {
                        const doneClass = todoItem.done ? 'done' : '';
                        const indentClass = todoItem.indent ? `indent-${todoItem.indent}` : '';
                        const sectionClass = todoItem.isSection ? 'section-header' : '';
                        tooltipHTML += `
                            <div class="recent-note-tooltip-item todo ${doneClass} ${sectionClass} ${indentClass}">
                                ${todoItem.done && !todoItem.isSection ? 'âœ“ ' : ''}${todoItem.content}
                            </div>
                        `;
                    });
                    
                    tooltipHTML += '</div>';
                }
                
                if (dateData.goalCount > 0) {
                    tooltipHTML += `
                        <div class="recent-note-tooltip-section">
                            <div class="recent-note-tooltip-section-title">
                                <i class="fas fa-bullseye" style="color: #e74c3c;"></i> Goals (${dateData.goalCount})
                            </div>
                    `;
                    
                    dateData.goals.forEach(goalItem => {
                        const doneClass = goalItem.done ? 'done' : '';
                        tooltipHTML += `
                            <div class="recent-note-tooltip-item goal ${doneClass}">
                                ${goalItem.done ? 'âœ“ ' : ''}${goalItem.text}
                            </div>
                        `;
                    });
                    
                    tooltipHTML += '</div>';
                }
                
                if (dateData.totalCount === 0) {
                    tooltipHTML += '<div class="recent-note-tooltip-empty">No notes, tasks, or goals for this day</div>';
                }
                
                tooltipHTML += `
                        </div>
                    </div>
                `;
                
                noteElement.innerHTML = `
                    <div class="recent-note-header">
                        <div class="recent-note-icon">
                            ${iconHtml}
                            ${countBadge}
                        </div>
                        <span class="recent-note-short-date">${shortDate}</span>
                    </div>
                    <div class="recent-note-preview">${note.preview}</div>
                    ${tooltipHTML}
                `;
                
                noteElement.addEventListener('click', () => {
                    document.querySelectorAll('.recent-note').forEach(n => n.classList.remove('active'));
                    noteElement.classList.add('active');
                    
                    selectedDate = new Date(note.date);
                    updateDateDisplays();
                    updateWeekNavigation();
                    updateMiniCalendar();
                    loadDailyView();
                });
                
                let tooltipTimeout;
                noteElement.addEventListener('mouseenter', () => {
                    tooltipTimeout = setTimeout(() => {
                        const tooltip = noteElement.querySelector('.recent-note-tooltip');
                        if (tooltip) {
                            tooltip.style.opacity = '1';
                        }
                    }, 300);
                });
                
                noteElement.addEventListener('mouseleave', () => {
                    clearTimeout(tooltipTimeout);
                    const tooltip = noteElement.querySelector('.recent-note-tooltip');
                    if (tooltip) {
                        tooltip.style.opacity = '0';
                    }
                });
                
                recentNotesList.appendChild(noteElement);
            });
        }

        // Helper function to get complete data for a date
        function getCompleteDateData(dateString) {
            const notes = notesData[dateString] || [];
            const todos = todosData[dateString] || [];
            const goals = goalsData[dateString] || [];
            
            return {
                notes: notes,
                todos: todos,
                goals: goals,
                noteCount: notes.length,
                todoCount: todos.length,
                goalCount: goals.length,
                totalCount: notes.length + todos.length + goals.length
            };
        }

        // Update recent notes active state
        function updateRecentNotesActiveState() {
            const dateString = formatDate(selectedDate);
            document.querySelectorAll('.recent-note').forEach(note => {
                note.classList.remove('active');
                if (note.dataset.date === dateString) {
                    note.classList.add('active');
                }
            });
        }

        // Search functionality
        function performSearch(query) {
            const resultsContainer = document.getElementById('search-results');
            
            if (!query || query.trim() === '') {
                resultsContainer.classList.add('hidden');
                return;
            }
            
            const searchTerm = query.toLowerCase().trim();
            const results = [];
            
            // Search in notes
            for (const [date, items] of Object.entries(notesData)) {
                for (const note of items) {
                    if (note.content.toLowerCase().includes(searchTerm)) {
                        results.push({
                            type: 'note',
                            date: date,
                            content: note.content,
                            item: note
                        });
                    }
                }
            }
            
            // Search in todos
            for (const [date, items] of Object.entries(todosData)) {
                for (const todo of items) {
                    if (todo.content.toLowerCase().includes(searchTerm)) {
                        results.push({
                            type: 'todo',
                            date: date,
                            content: todo.content,
                            item: todo
                        });
                    }
                }
            }
            
            // Display results
            displaySearchResults(results);
        }

        // Display search results
        function displaySearchResults(results) {
            const resultsContainer = document.getElementById('search-results');
            const resultsList = document.getElementById('search-results-list');
            const resultsCount = document.getElementById('results-count');
            
            resultsList.innerHTML = '';
            
            if (results.length === 0) {
                resultsCount.textContent = 'No results found';
                resultsContainer.classList.remove('hidden');
                return;
            }
            
            resultsCount.textContent = `${results.length} result${results.length !== 1 ? 's' : ''} found`;
            
            results.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            results.forEach(result => {
                const resultElement = document.createElement('div');
                resultElement.className = 'search-result-item';
                resultElement.innerHTML = `
                    <div class="search-result-date">${formatDateDisplay(new Date(result.date))}</div>
                    <div class="search-result-content">${result.content}</div>
                    <span class="search-result-type">${result.type === 'note' ? 'Note' : 'Todo'}</span>
                `;
                
                resultElement.addEventListener('click', () => {
                    selectedDate = new Date(result.date);
                    updateDateDisplays();
                    updateWeekNavigation();
                    updateMiniCalendar();
                    loadDailyView();
                    updateRecentNotesActiveState();
                    
                    resultsContainer.classList.add('hidden');
                    document.getElementById('search-input').value = '';
                    
                    highlightSearchResult(result);
                });
                
                resultsList.appendChild(resultElement);
            });
            
            resultsContainer.classList.remove('hidden');
        }

        // Highlight search result in the list
        function highlightSearchResult(result) {
            document.querySelectorAll('.bullet-item.highlight').forEach(item => {
                item.classList.remove('highlight');
            });
            
            setTimeout(() => {
                const list = result.type === 'note' ? document.getElementById('notes-list') : document.getElementById('todo-list');
                const items = list.querySelectorAll('.bullet-item');
                
                items.forEach(item => {
                    const content = item.querySelector('.bullet-content').textContent;
                    if (content === result.content) {
                        item.classList.add('highlight');
                        item.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                        setTimeout(() => {
                            item.classList.remove('highlight');
                        }, 3000);
                    }
                });
            }, 100);
        }

        // Add new note
        function addNewNote() {
            const dateString = formatDate(selectedDate);
            if (!notesData[dateString]) notesData[dateString] = [];
            
            const lastNote = notesData[dateString][notesData[dateString].length - 1];
            if (lastNote && lastNote.content.trim() === '') {
                loadDailyView();
                setTimeout(() => {
                    const notesList = document.getElementById('notes-list');
                    if (notesList && notesList.children.length > 0) {
                        const lastNoteElement = notesList.lastChild;
                        if (lastNoteElement) {
                            const contentElement = lastNoteElement.querySelector('.bullet-content');
                            if (contentElement) {
                                contentElement.focus();
                                
                                const range = document.createRange();
                                const selection = window.getSelection();
                                range.selectNodeContents(contentElement);
                                range.collapse(false);
                                selection.removeAllRanges();
                                selection.addRange(range);
                            }
                        }
                    }
                }, 10);
                return;
            }
            
            const maxId = notesData[dateString].length > 0 ? 
                Math.max(...notesData[dateString].map(n => n.id)) : 0;
            
            const newNote = {
                id: maxId + 1,
                content: '',
                type: 'note',
                indent: 0
            };
            
            notesData[dateString].push(newNote);
            
            const recentNote = {
                date: dateString,
                title: formatDateDisplay(selectedDate) + ' - Notes',
                preview: 'New note added...'
            };
            
            const noteExists = recentNotesData.some(note => note.date === dateString);
            if (!noteExists) {
                recentNotesData.push(recentNote);
            } else {
                const existingIndex = recentNotesData.findIndex(note => note.date === dateString);
                if (existingIndex !== -1) {
                    recentNotesData[existingIndex] = recentNote;
                }
            }
            
            loadDailyView();
            loadRecentNotes();
            updateStats();
            
            updateMiniCalendar();
            updateWeekNavigation();
            
            setTimeout(() => {
                const notesList = document.getElementById('notes-list');
                if (notesList && notesList.children.length > 0) {
                    const lastNote = notesList.lastChild;
                    if (lastNote) {
                        const contentElement = lastNote.querySelector('.bullet-content');
                        if (contentElement) {
                            contentElement.focus();
                            
                            const range = document.createRange();
                            const selection = window.getSelection();
                            range.selectNodeContents(contentElement);
                            range.collapse(true);
                            selection.removeAllRanges();
                            selection.addRange(range);
                            
                            contentElement.addEventListener('input', () => {
                                const content = contentElement.textContent.trim();
                                if (content) {
                                    const preview = content.length > 50 ? content.substring(0, 50) + '...' : content;
                                    
                                    const noteIndex = recentNotesData.findIndex(note => note.date === dateString);
                                    if (noteIndex !== -1) {
                                        recentNotesData[noteIndex].preview = preview;
                                        const firstWords = content.split(' ').slice(0, 3).join(' ');
                                        recentNotesData[noteIndex].title = firstWords || 'New Note';
                                        loadRecentNotes();
                                    }
                                }
                            });
                        }
                    }
                }
            }, 10);
            
            saveToLocalStorage();
        }

        // Add new todo
        function addNewTodo() {
            const dateString = formatDate(selectedDate);
            if (!todosData[dateString]) todosData[dateString] = [];
            
            const lastTodo = todosData[dateString][todosData[dateString].length - 1];
            if (lastTodo && lastTodo.content.trim() === '') {
                loadDailyView();
                setTimeout(() => {
                    const todoList = document.getElementById('todo-list');
                    if (todoList && todoList.children.length > 0) {
                        const lastTodoElement = todoList.lastChild;
                        if (lastTodoElement) {
                            const contentElement = lastTodoElement.querySelector('.bullet-content');
                            if (contentElement) {
                                contentElement.focus();
                                
                                const range = document.createRange();
                                const selection = window.getSelection();
                                range.selectNodeContents(contentElement);
                                range.collapse(false);
                                selection.removeAllRanges();
                                selection.addRange(range);
                            }
                        }
                    }
                }, 10);
                return;
            }
            
            const maxId = todosData[dateString].length > 0 ? 
                Math.max(...todosData[dateString].map(t => t.id)) : 0;
            
            const newTodo = {
                id: maxId + 1,
                content: '',
                type: 'todo',
                done: false,
                indent: 0
            };
            
            todosData[dateString].push(newTodo);
            
            const recentNote = {
                date: dateString,
                title: formatDateDisplay(selectedDate) + ' - Tasks',
                preview: 'New task added...'
            };
            
            const noteExists = recentNotesData.some(note => note.date === dateString);
            if (!noteExists) {
                recentNotesData.push(recentNote);
            } else {
                const existingIndex = recentNotesData.findIndex(note => note.date === dateString);
                if (existingIndex !== -1) {
                    if (recentNotesData[existingIndex].title.includes('New')) {
                        recentNotesData[existingIndex] = recentNote;
                    }
                }
            }
            
            loadDailyView();
            loadRecentNotes();
            updateStats();
            
            updateMiniCalendar();
            updateWeekNavigation();
            
            setTimeout(() => {
                const todoList = document.getElementById('todo-list');
                if (todoList && todoList.children.length > 0) {
                    const lastTodo = todoList.lastChild;
                    if (lastTodo) {
                        const contentElement = lastTodo.querySelector('.bullet-content');
                        if (contentElement) {
                            contentElement.focus();
                            
                            const range = document.createRange();
                            const selection = window.getSelection();
                            range.selectNodeContents(contentElement);
                            range.collapse(true);
                            selection.removeAllRanges();
                            selection.addRange(range);
                            
                            contentElement.addEventListener('input', () => {
                                const content = contentElement.textContent.trim();
                                if (content) {
                                    const preview = content.length > 50 ? content.substring(0, 50) + '...' : content;
                                    
                                    const noteIndex = recentNotesData.findIndex(note => note.date === dateString);
                                    if (noteIndex !== -1) {
                                        recentNotesData[noteIndex].preview = preview;
                                        const hasNotes = notesData[dateString] && notesData[dateString].length > 0;
                                        const hasTodos = todosData[dateString] && todosData[dateString].length > 0;
                                        
                                        if (hasNotes && hasTodos) {
                                            recentNotesData[noteIndex].title = formatDateDisplay(selectedDate);
                                        } else if (hasTodos) {
                                            const firstWords = content.split(' ').slice(0, 3).join(' ');
                                            recentNotesData[noteIndex].title = firstWords || 'New Task';
                                        }
                                        loadRecentNotes();
                                    }
                                }
                            });
                        }
                    }
                }
            }, 10);
            
            saveToLocalStorage();
        }

        // Add new goal
        function addNewGoal() {
            const dateString = formatDate(selectedDate);
            if (!goalsData[dateString]) goalsData[dateString] = [];
            
            const maxId = goalsData[dateString].length > 0 ? 
                Math.max(...goalsData[dateString].map(g => g.id)) : 0;
            
            const newGoal = {
                id: maxId + 1,
                text: '',
                done: false
            };
            
            goalsData[dateString].push(newGoal);
            loadDailyView();
            updateStats();
            
            updateMiniCalendar();
            updateWeekNavigation();
            
            setTimeout(() => {
                const goalsList = document.getElementById('goals-list');
                const lastGoal = goalsList.lastChild;
                if (lastGoal) {
                    lastGoal.querySelector('.goal-text').focus();
                }
            }, 10);
            
            saveToLocalStorage();
        }

        // Clear completed goals
        function clearCompletedGoals() {
            const dateString = formatDate(selectedDate);
            if (goalsData[dateString]) {
                goalsData[dateString] = goalsData[dateString].filter(g => !g.done);
                loadDailyView();
                updateStats();
                saveToLocalStorage();
                
                updateMiniCalendar();
                updateWeekNavigation();
            }
        }

        // Save item content
        function saveItemContent(item, type, content) {
            const dateString = formatDate(selectedDate);
            const data = type === 'note' ? notesData : todosData;
            
            if (data[dateString]) {
                const foundItem = data[dateString].find(i => i.id === item.id);
                if (foundItem) {
                    foundItem.content = content;
                    saveToLocalStorage();
                }
            }
        }

        // Save item status
        function saveItemStatus(item, type) {
            const dateString = formatDate(selectedDate);
            const data = type === 'note' ? notesData : todosData;
            
            if (data[dateString]) {
                const foundItem = data[dateString].find(i => i.id === item.id);
                if (foundItem) {
                    foundItem.done = item.done;
                    saveToLocalStorage();
                }
            }
        }

        // Update statistics
        function updateStats() {
            const dateString = formatDate(selectedDate);
            
            const todos = todosData[dateString] || [];
            const completedTodos = todos.filter(t => t.done).length;
            const totalTodos = todos.length;
            
            const notes = notesData[dateString] || [];
            const totalNotes = notes.length;
            
            const goals = goalsData[dateString] || [];
            const completedGoals = goals.filter(g => g.done).length;
            const totalGoals = goals.length;
            
            document.getElementById('completed-tasks').textContent = `${completedTodos + completedGoals}/${totalTodos + totalGoals}`;
            document.getElementById('notes-count').textContent = totalNotes;
            document.getElementById('goals-progress').textContent = `${completedGoals}/${totalGoals}`;
        }

        // Save to localStorage
        function saveToLocalStorage() {
            const data = {
                notes: notesData,
                todos: todosData,
                goals: goalsData,
                recentNotes: recentNotesData,
                lastSave: new Date().toISOString()
            };
            
            try {
                localStorage.setItem('remnoteData', JSON.stringify(data));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            try {
                const savedData = localStorage.getItem('remnoteData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    if (data.notes && data.todos && data.goals) {
                        notesData = data.notes;
                        todosData = data.todos;
                        goalsData = data.goals;
                        recentNotesData = data.recentNotes || recentNotesData;
                        
                        loadDailyView();
                        loadRecentNotes();
                        updateStats();
                    }
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
        }

        // Save to JSON file
        function saveDataToFile() {
            const data = {
                notes: notesData,
                todos: todosData,
                goals: goalsData,
                recentNotes: recentNotesData,
                metadata: {
                    exportDate: new Date().toISOString(),
                    version: '1.0'
                }
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const today = new Date();
            const filename = `Remnote-${today.getFullYear()}${String(today.getMonth() + 1).padStart(2, '0')}${String(today.getDate()).padStart(2, '0')}.json`;
            
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load from JSON file
        function loadDataFromFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (data.notes && data.todos && data.goals) {
                        notesData = data.notes;
                        todosData = data.todos;
                        goalsData = data.goals;
                        recentNotesData = data.recentNotes || recentNotesData;
                        
                        loadDailyView();
                        loadRecentNotes();
                        updateStats();
                        saveToLocalStorage();
                        
                        updateMiniCalendar();
                        updateWeekNavigation();
                    }
                } catch (error) {
                    console.error('Error loading file:', error);
                }
            };
            
            reader.readAsText(file);
        }

        // Date picker functions
        function openDatePicker() {
            const modal = document.getElementById('date-picker-modal');
            const container = document.getElementById('date-picker-days');
            
            while (container.children.length > 7) {
                container.removeChild(container.lastChild);
            }
            
            const year = selectedDate.getFullYear();
            const month = selectedDate.getMonth();
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const firstDayOfWeek = firstDay.getDay();
            
            for (let i = 0; i < firstDayOfWeek; i++) {
                const prevMonthDay = new Date(year, month, -i);
                const dateString = formatDate(prevMonthDay);
                const dateElement = document.createElement('div');
                dateElement.className = 'date-picker-date other-month';
                dateElement.textContent = prevMonthDay.getDate();
                dateElement.dataset.date = dateString;
                
                if (dateHasData(dateString)) {
                    dateElement.classList.add('has-data');
                }
                
                container.appendChild(dateElement);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateString = formatDate(date);
                const dateElement = document.createElement('div');
                dateElement.className = 'date-picker-date';
                dateElement.textContent = day;
                dateElement.dataset.date = dateString;
                
                const today = new Date();
                if (dateString === formatDate(today)) {
                    dateElement.classList.add('today');
                }
                
                if (dateString === formatDate(selectedDate)) {
                    dateElement.classList.add('selected');
                }
                
                if (dateHasData(dateString)) {
                    dateElement.classList.add('has-data');
                    dateElement.title = 'Has notes/todos/goals';
                }
                
                container.appendChild(dateElement);
            }
            
            const totalCells = 42;
            const cellsUsed = firstDayOfWeek + daysInMonth;
            const cellsRemaining = totalCells - cellsUsed;
            
            for (let i = 1; i <= cellsRemaining; i++) {
                const nextMonthDay = new Date(year, month + 1, i);
                const dateString = formatDate(nextMonthDay);
                const dateElement = document.createElement('div');
                dateElement.className = 'date-picker-date other-month';
                dateElement.textContent = i;
                dateElement.dataset.date = dateString;
                
                if (dateHasData(dateString)) {
                    dateElement.classList.add('has-data');
                }
                
                container.appendChild(dateElement);
            }
            
            container.querySelectorAll('.date-picker-date').forEach(cell => {
                cell.addEventListener('click', () => {
                    container.querySelectorAll('.date-picker-date').forEach(c => {
                        c.classList.remove('selected');
                    });
                    cell.classList.add('selected');
                });
            });
            
            modal.style.display = 'flex';
        }

        function closeDatePicker() {
            document.getElementById('date-picker-modal').style.display = 'none';
        }

        function handleDateSelection() {
            const selectedCell = document.querySelector('#date-picker-days .date-picker-date.selected');
            
            if (selectedCell) {
                const selectedDateString = selectedCell.dataset.date;
                
                if (datePickerMode === 'move-item') {
                    if (selectedItemForMove) {
                        moveItemToDate(
                            selectedItemForMove.id,
                            selectedItemForMove.type,
                            selectedItemForMove.date,
                            new Date(selectedDateString)
                        );
                        selectedItemForMove = null;
                    }
                } else {
                    selectedDate = new Date(selectedDateString);
                    updateDateDisplays();
                    updateWeekNavigation();
                    updateMiniCalendar();
                    loadDailyView();
                    updateRecentNotesActiveState();
                }
                closeDatePicker();
            }
        }
        
        // Selection and Copy/Paste Functions
        
        // Toggle selection mode
        function toggleSelectMode() {
            isSelectMode = !isSelectMode;
            const indicator = document.getElementById('select-mode-indicator');
            indicator.style.display = isSelectMode ? 'block' : 'none';
            
            if (!isSelectMode) {
                clearSelection();
            }
            
            showNotification(isSelectMode ? 'Selection Mode Activated' : 'Selection Mode Deactivated');
        }

        // Toggle item selection
        function toggleItemSelection(itemElement, itemType, ctrlKey = false) {
            if (!isSelectMode && !ctrlKey) return;
            
            const itemId = itemElement.dataset.id;
            const dateString = formatDate(selectedDate);
            
            const key = `${dateString}|${itemType}|${itemId}`;
            
            if (selectedItems.has(key)) {
                selectedItems.delete(key);
                itemElement.classList.remove('selected', 'multi-selected');
            } else {
                selectedItems.add(key);
                if (selectedItems.size > 1) {
                    itemElement.classList.add('multi-selected');
                } else {
                    itemElement.classList.add('selected');
                }
            }
            
            updateSelectionControls();
        }

        // Get item data from key
        function getItemData(key) {
            const parts = key.split('|');
            
            if (parts.length !== 3) {
                console.error('Invalid key format:', key);
                return null;
            }
            
            const dateString = parts[0];
            const type = parts[1];
            const id = parseInt(parts[2]);
            
            if (type === 'note' && notesData[dateString]) {
                return notesData[dateString].find(item => item.id === id);
            } else if (type === 'todo' && todosData[dateString]) {
                return todosData[dateString].find(item => item.id === id);
            } else if (type === 'goal' && goalsData[dateString]) {
                return goalsData[dateString].find(item => item.id === id);
            }
            
            return null;
        }

        // Clear all selections
        function clearSelection() {
            document.querySelectorAll('.bullet-item.selected, .bullet-item.multi-selected, .goal-item.selected, .goal-item.multi-selected').forEach(item => {
                item.classList.remove('selected', 'multi-selected');
            });
            selectedItems.clear();
            updateSelectionControls();
        }

        // Update selection controls visibility
        function updateSelectionControls() {
            const controls = document.getElementById('selection-controls');
            const countElement = document.getElementById('selected-count');
            
            if (selectedItems.size > 0) {
                controls.style.display = 'flex';
                countElement.textContent = `${selectedItems.size} selected`;
            } else {
                controls.style.display = 'none';
            }
        }

        // Copy selected items to buffer AND system clipboard
        function copySelectedItems() {
            copyBuffer = [];
            let copiedCount = 0;
            
            selectedItems.forEach(key => {
                const data = getItemData(key);
                
                if (data) {
                    const copy = { ...data };
                    delete copy.id;
                    
                    const parts = key.split('|');
                    const dateString = parts[0];
                    const type = parts[1];
                    
                    copyBuffer.push({
                        type: type,
                        data: copy,
                        originalDate: dateString
                    });
                    copiedCount++;
                }
            });
            
            if (copiedCount > 0) {
                let clipboardText = '';
                copyBuffer.forEach(item => {
                    const prefix = item.type === 'note' ? 'â€¢ ' : item.type === 'todo' ? 'â˜ ' : 'ðŸŽ¯ ';
                    const content = item.data.content || item.data.text || '';
                    const doneMarker = item.data.done ? 'âœ“ ' : '';
                    const indent = item.data.indent ? '  '.repeat(item.data.indent) : '';
                    const sectionMarker = item.data.isSection ? '## ' : '';
                    clipboardText += `${indent}${doneMarker}${sectionMarker}${prefix}${content}\n`;
                });
                
                if (copyBuffer.length > 0 && copyBuffer[0].originalDate) {
                    const originalDate = new Date(copyBuffer[0].originalDate);
                    clipboardText = `Copied from ${formatDateDisplay(originalDate)}:\n\n${clipboardText}`;
                }
                
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(clipboardText)
                        .then(() => {
                            showNotification(`âœ… Copied ${copiedCount} item${copiedCount !== 1 ? 's' : ''} to clipboard`);
                        })
                        .catch(err => {
                            console.error('Clipboard API failed:', err);
                            copyToClipboardFallback(clipboardText, copiedCount);
                        });
                } else {
                    copyToClipboardFallback(clipboardText, copiedCount);
                }
            } else {
                showNotification('âš ï¸ No items selected to copy');
            }
        }

        // Fallback method for clipboard copying
        function copyToClipboardFallback(text, count) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showNotification(`âœ… Copied ${count} item${count !== 1 ? 's' : ''} to clipboard`);
                } else {
                    showNotification('âš ï¸ Could not copy to clipboard. Please select and copy manually.');
                }
            } catch (err) {
                console.error('Fallback clipboard copy failed:', err);
                showNotification('âš ï¸ Clipboard access blocked. Please enable clipboard permissions.');
            }
            
            document.body.removeChild(textArea);
        }

        // Cut selected items
        function cutSelectedItems() {
            copySelectedItems();
            
            if (copyBuffer.length > 0) {
                selectedItems.forEach(key => {
                    const parts = key.split('|');
                    if (parts.length === 3) {
                        const dateString = parts[0];
                        const type = parts[1];
                        const id = parseInt(parts[2]);
                        
                        deleteItem(id, type, dateString);
                    }
                });
                
                clearSelection();
                showNotification(`âœ‚ï¸ Cut ${copyBuffer.length} item${copyBuffer.length !== 1 ? 's' : ''}`);
            }
        }

        // Paste items at current position
        function pasteItems() {
            if (copyBuffer.length === 0) {
                showNotification('No items to paste');
                return;
            }
            
            const currentDateString = formatDate(selectedDate);
            
            copyBuffer.forEach(itemToPaste => {
                const { type, data } = itemToPaste;
                
                if (type === 'note' || type === 'todo') {
                    const targetData = type === 'note' ? notesData : todosData;
                    
                    if (!targetData[currentDateString]) {
                        targetData[currentDateString] = [];
                    }
                    
                    const newId = targetData[currentDateString].length > 0 ? 
                        Math.max(...targetData[currentDateString].map(i => i.id)) + 1 : 1;
                    
                    const newItem = {
                        ...data,
                        id: newId
                    };
                    
                    targetData[currentDateString].push(newItem);
                } else if (type === 'goal') {
                    if (!goalsData[currentDateString]) {
                        goalsData[currentDateString] = [];
                    }
                    
                    const newId = goalsData[currentDateString].length > 0 ? 
                        Math.max(...goalsData[currentDateString].map(g => g.id)) + 1 : 1;
                    
                    const newGoal = {
                        ...data,
                        id: newId
                    };
                    
                    goalsData[currentDateString].push(newGoal);
                }
            });
            
            loadDailyView();
            saveToLocalStorage();
            
            showNotification(`Pasted ${copyBuffer.length} item${copyBuffer.length !== 1 ? 's' : ''}`);
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #2ecc71;
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                animation: slideIn 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 2000);
        }

        // Setup event listeners
        function setupEventListeners() {
            setupFloatingButtons();
            
            // Day navigation
            document.getElementById('prev-day').addEventListener('click', () => {
                selectedDate.setDate(selectedDate.getDate() - 1);
                updateDateDisplays();
                updateWeekNavigation();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            document.getElementById('next-day').addEventListener('click', () => {
                selectedDate.setDate(selectedDate.getDate() + 1);
                updateDateDisplays();
                updateWeekNavigation();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            document.getElementById('today-btn').addEventListener('click', () => {
                selectedDate = new Date();
                updateDateDisplays();
                updateWeekNavigation();
                updateMiniCalendar();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            // Delete day button
            document.getElementById('delete-day-btn').addEventListener('click', deleteCurrentDay);
            
            // Delete confirmation buttons
            document.getElementById('delete-cancel-btn').addEventListener('click', () => {
                document.getElementById('delete-confirm-modal').style.display = 'none';
            });
            
            document.getElementById('delete-confirm-btn').addEventListener('click', confirmDeleteDay);
            
            // Week navigation
            document.getElementById('prev-week').addEventListener('click', () => {
                selectedDate.setDate(selectedDate.getDate() - 7);
                updateDateDisplays();
                updateWeekNavigation();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            document.getElementById('next-week').addEventListener('click', () => {
                selectedDate.setDate(selectedDate.getDate() + 7);
                updateDateDisplays();
                updateWeekNavigation();
                loadDailyView();
                updateRecentNotesActiveState();
            });
            
            // Mini calendar navigation
            document.getElementById('prev-mini-month').addEventListener('click', () => {
                miniCalendarMonth--;
                if (miniCalendarMonth < 0) {
                    miniCalendarMonth = 11;
                    miniCalendarYear--;
                }
                updateMiniCalendar();
            });
            
            document.getElementById('next-mini-month').addEventListener('click', () => {
                miniCalendarMonth++;
                if (miniCalendarMonth > 11) {
                    miniCalendarMonth = 0;
                    miniCalendarYear++;
                }
                updateMiniCalendar();
            });
            
            // Search
            const searchInput = document.getElementById('search-input');
            let searchDebounceTimer = null;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchDebounceTimer);
                const value = e.target.value;
                searchDebounceTimer = setTimeout(() => performSearch(value), 120);
            });
            
            // Close search results when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.search-results') && !e.target.closest('.search-container')) {
                    document.getElementById('search-results').classList.add('hidden');
                }
            });
            
            // Add buttons
            document.getElementById('add-note-btn').addEventListener('click', addNewNote);
            document.getElementById('add-todo-btn').addEventListener('click', addNewTodo);
            document.getElementById('add-goal-btn').addEventListener('click', addNewGoal);
            document.getElementById('add-goal-full-btn').addEventListener('click', addNewGoal);
            
            // NEW: Section header buttons for both notes and todos
            document.getElementById('add-section-btn-notes').addEventListener('click', addSectionHeaderNotes);
            document.getElementById('add-section-btn').addEventListener('click', addSectionHeaderTodos);
            
// NEW: Dated section header button for tasks
document.getElementById('add-dated-section-btn').addEventListener('click', addDatedSectionHeaderTodos);

// NEW: Setup notes section dropdown
setupNotesSectionDropdown();

            // NEW: Remove empty sections buttons for both notes and todos
            document.getElementById('remove-empty-sections-btn-notes').addEventListener('click', () => {
                const dateString = formatDate(selectedDate);
                if (notesData[dateString]) {
                    const originalLength = notesData[dateString].length;
                    notesData[dateString] = notesData[dateString].filter(item => {
                        return !item.isSection || (item.isSection && item.content.trim() !== '');
                    });
                    
                    const removedCount = originalLength - notesData[dateString].length;
                    if (removedCount > 0) {
                        loadDailyView();
                        saveToLocalStorage();
                        showNotification(`Removed ${removedCount} empty section${removedCount !== 1 ? 's' : ''} from notes`);
                    } else {
                        showNotification('No empty sections found in notes');
                    }
                }
            });
            
            document.getElementById('remove-empty-sections-btn').addEventListener('click', () => {
                const dateString = formatDate(selectedDate);
                if (todosData[dateString]) {
                    const originalLength = todosData[dateString].length;
                    todosData[dateString] = todosData[dateString].filter(item => {
                        return !item.isSection || (item.isSection && item.content.trim() !== '');
                    });
                    
                    const removedCount = originalLength - todosData[dateString].length;
                    if (removedCount > 0) {
                        loadDailyView();
                        saveToLocalStorage();
                        showNotification(`Removed ${removedCount} empty section${removedCount !== 1 ? 's' : ''} from tasks`);
                    } else {
                        showNotification('No empty sections found in tasks');
                    }
                }
            });
            
            // Clear completed goals
            document.getElementById('clear-done-goals').addEventListener('click', clearCompletedGoals);
            
            // File controls
            document.getElementById('save-data-btn').addEventListener('click', saveDataToFile);
            document.getElementById('load-data-btn').addEventListener('click', () => {
                document.getElementById('file-input').click();
            });
            
            document.getElementById('file-input').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    loadDataFromFile(e.target.files[0]);
                    e.target.value = '';
                }
            });
            
            // Selection mode toggle
            document.getElementById('toggle-select-mode').addEventListener('click', toggleSelectMode);
            
            // Date picker
            document.getElementById('open-date-picker').addEventListener('click', () => {
                datePickerMode = 'navigation';
                openDatePicker();
            });
            
            document.getElementById('date-picker-close').addEventListener('click', closeDatePicker);
            document.getElementById('date-picker-cancel').addEventListener('click', closeDatePicker);
            document.getElementById('date-picker-select').addEventListener('click', handleDateSelection);
            
            // Slash menu actions
            setupSlashMenuActions();
            
            // Selection and Copy/Paste Event Listeners
            
            // Ctrl+Click for multi-selection
            document.addEventListener('click', (e) => {
                const bulletItem = e.target.closest('.bullet-item');
                const goalItem = e.target.closest('.goal-item');
                
                if (bulletItem) {
                    const type = bulletItem.classList.contains('todo') ? 'todo' : 'note';
                    toggleItemSelection(bulletItem, type, e.ctrlKey || e.metaKey);
                } else if (goalItem) {
                    toggleItemSelection(goalItem, 'goal', e.ctrlKey || e.metaKey);
                } else if (!e.target.closest('.selection-controls')) {
                    if (!isSelectMode && selectedItems.size > 0 && !e.ctrlKey && !e.metaKey) {
                        clearSelection();
                    }
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + A to select all items in current view
                if ((e.ctrlKey || e.metaKey) && e.key === 'a') {
                    e.preventDefault();
                    
                    const currentDateString = formatDate(selectedDate);
                    
                    document.querySelectorAll('.bullet-item').forEach(item => {
                        const type = item.classList.contains('todo') ? 'todo' : 'note';
                        const itemId = item.dataset.id;
                        const key = `${currentDateString}|${type}|${itemId}`;
                        selectedItems.add(key);
                        item.classList.add('selected');
                    });
                    
                    document.querySelectorAll('.goal-item').forEach(item => {
                        const itemId = item.dataset.id;
                        const key = `${currentDateString}|goal|${itemId}`;
                        selectedItems.add(key);
                        item.classList.add('selected');
                    });
                    
                    updateSelectionControls();
                }
                
                // Ctrl/Cmd + C to copy
                if ((e.ctrlKey || e.metaKey) && e.key === 'c' && selectedItems.size > 0) {
                    e.preventDefault();
                    copySelectedItems();
                }
                
                // Ctrl/Cmd + X to cut
                if ((e.ctrlKey || e.metaKey) && e.key === 'x' && selectedItems.size > 0) {
                    e.preventDefault();
                    cutSelectedItems();
                }
                
                // Ctrl/Cmd + V to paste
                if ((e.ctrlKey || e.metaKey) && e.key === 'v' && copyBuffer.length > 0) {
                    e.preventDefault();
                    pasteItems();
                }
                
                // Esc to clear selection
                if (e.key === 'Escape' && selectedItems.size > 0) {
                    clearSelection();
                }
                
                // DELETE KEY FUNCTIONALITY
                const activeElement = document.activeElement;
                
                if ((e.key === 'Delete' || e.key === 'Backspace') && 
                    (activeElement.classList.contains('bullet-content') || 
                     activeElement.classList.contains('goal-text'))) {
                    
                    if (activeElement.textContent.trim() === '') {
                        e.preventDefault();
                        
                        const itemElement = activeElement.closest('.bullet-item, .goal-item');
                        
                        if (itemElement) {
                            if (itemElement.classList.contains('bullet-item')) {
                                const itemId = parseInt(itemElement.dataset.id);
                                const type = itemElement.classList.contains('todo') ? 'todo' : 'note';
                                deleteItem(itemId, type, formatDate(selectedDate));
                            } else if (itemElement.classList.contains('goal-item')) {
                                const goalId = parseInt(itemElement.dataset.id);
                                const dateString = formatDate(selectedDate);
                                
                                if (goalsData[dateString]) {
                                    const index = goalsData[dateString].findIndex(g => g.id === goalId);
                                    if (index !== -1) {
                                        goalsData[dateString].splice(index, 1);
                                        loadDailyView();
                                        updateStats();
                                        saveToLocalStorage();
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            // Selection control buttons
            document.getElementById('copy-selected-btn').addEventListener('click', copySelectedItems);
            document.getElementById('paste-btn').addEventListener('click', pasteItems);
            document.getElementById('cut-selected-btn').addEventListener('click', cutSelectedItems);
            document.getElementById('deselect-all-btn').addEventListener('click', clearSelection);
            
            // View toggle buttons
            document.getElementById('daily-view-btn').addEventListener('click', () => {
                toggleView('daily');
            });
            
            document.getElementById('review-view-btn').addEventListener('click', () => {
                toggleView('review');
            });
            
            // Review filter
            document.getElementById('review-filter').addEventListener('change', () => {
                if (currentView === 'review') {
                    loadSevenDayReview();
                }
            });
            
            // Expand/Collapse all buttons
            document.getElementById('expand-all-btn').addEventListener('click', expandAllPanels);
            document.getElementById('collapse-all-btn').addEventListener('click', collapseAllPanels);
            
            // Hide calendar preview when clicking anywhere
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.calendar-preview') && !e.target.closest('.mini-calendar-day')) {
                    hideCalendarPreview();
                }
            });
            
            // Hide week preview when clicking anywhere
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.week-preview') && !e.target.closest('.week-day')) {
                    hideWeekPreview();
                }
            });
            
            // Hide previews when scrolling
            document.addEventListener('scroll', () => {
                hideCalendarPreview();
                hideWeekPreview();
            });
            
            // Auto-save
            setInterval(saveToLocalStorage, 30000);
            
            // Add drag and drop events for sections (for visual feedback)
            document.querySelectorAll('.section').forEach(section => {
                section.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    if (dragItem && dragType !== 'goal') {
                        const sectionType = section.dataset.type;
                        if (dragType !== sectionType) {
                            section.classList.add('drag-over');
                        }
                    }
                });
                
                section.addEventListener('dragleave', (e) => {
                    if (!section.contains(e.relatedTarget)) {
                        section.classList.remove('drag-over');
                    }
                });
                
                section.addEventListener('drop', (e) => {
                    e.preventDefault();
                    section.classList.remove('drag-over');
                });
            });
        }

        // Initialize the app
        initApp();
    </script>
</body>
</html>